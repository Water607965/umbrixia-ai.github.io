<!DOCTYPE html>
 <html lang="en">
 <head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <title>Umbrixia | Dashboard</title>
   <link rel="stylesheet" href="styles.css" />
   <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
   <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
   <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>



 



 
 
   <style>
     body {
       margin: 0;
       font-family: 'Inter', sans-serif;
       background-color: #0d0d0d;
       color: white;
     }

    .dashboard {
  width: 100%;
  padding: 60px 40px;
  margin: 0;
  display: flex;
  flex-direction: row; /* ‚Üê Important change */
  flex-wrap: wrap;
  gap: 40px;
  box-sizing: border-box;
}


     h1 {
       font-size: 2.8rem;
       text-align: center;
       color: #ff4d4d;
       margin-bottom: 10px;
     }
     .sub {
       text-align: center;
       font-size: 1.1rem;
       color: #999;
       margin-bottom: 40px;
     }
     .test-buttons {
       display: flex;
       justify-content: center;
       gap: 20px;
       flex-wrap: wrap;
       margin-bottom: 40px;
     }
     .test-buttons button {
       background-color: #111;
       border: 1px solid #ff4d4d;
       padding: 15px 30px;
       font-size: 1rem;
       color: white;
       border-radius: 12px;
       cursor: pointer;
       transition: 0.2s ease;
     }
     .test-buttons button:hover {
       background-color: #ff4d4d;
       color: #0d0d0d;
     }
     .test-section {
       display: none;
       animation: fadeIn 0.4s ease;
     }
     .practice-grid {
       display: grid;
       grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
       gap: 25px;
       margin-bottom: 50px;
     }
     .practice-card {
       background: #111;
       border: 1px solid #222;
       padding: 25px;
       border-radius: 14px;
       box-shadow: 0 0 10px #191919;
       text-align: center;
       transition: 0.2s ease;
     }
     .practice-card:hover {
       box-shadow: 0 0 15px #ff4d4d;
     }
     .practice-card h3 {
       color: #ff4d4d;
     }
     .puzzle-section {
       margin-top: 30px;
       background-color: #141414;
       padding: 20px;
       border-radius: 14px;
       box-shadow: 0 0 8px #181818;
     }
     .puzzle-section h4 {
       color: #ff4d4d;
     }
     @keyframes fadeIn {
       from { opacity: 0; transform: translateY(10px); }
       to { opacity: 1; transform: translateY(0); }
     }
   </style>
   <style>
   #loading-screen {
     position: fixed;
     inset: 0;
     background: #0d0d0d;
     display: flex;
     justify-content: center;
     align-items: center;
     z-index: 9999;
     font-size: 1.5rem;
     color: white;
     font-weight: bold;
     animation: fadeIn 0.3s ease-in-out;
   }
 
     h1 {
   background: linear-gradient(90deg, #ff4d4d, #ff9900, #4caf50, #2196f3, #9c27b0);
   -webkit-background-clip: text;
   color: transparent;
   font-weight: 800;
 }
    @media (max-width: 600px) {
  .dashboard {
    padding: 20px 10px;
  }
  h1.gradient-heading {
    font-size: 2rem;
  }
  .glass-card {
    padding: 20px;
  }
}

 
 </style>
 
   <style>
   #universal-loader {
     position: fixed;
     inset: 0;
     background: #0d0d0d;
     z-index: 9999;
     display: flex;
     flex-direction: column;
     justify-content: center;
     align-items: center;
     animation: fadeIn 0.4s ease-in-out;
   }
 
   .spinner {
     border: 5px solid #333;
     border-top: 5px solid #ff4d4d;
     border-radius: 50%;
     width: 60px;
     height: 60px;
     animation: spin 1s linear infinite;
     margin-bottom: 16px;
   }
 
   @keyframes spin {
     to { transform: rotate(360deg); }
   }

    .dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
  gap: 40px;
  padding: 60px 40px;
  max-width: 1440px;
  margin: auto;
}


    .glass-card {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(12px);
  border-radius: 18px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
  padding: 30px;
  transition: all 0.3s ease-in-out;
}
.glass-card:hover {
  box-shadow: 0 12px 30px rgba(255, 77, 77, 0.4);
  transform: translateY(-2px);
}

    button.btn-glow {
  background: linear-gradient(90deg, #ff4d4d, #ff0080);
  border: none;
  color: white;
  padding: 14px 30px;
  font-size: 1rem;
  border-radius: 999px;
  box-shadow: 0 0 12px rgba(255, 77, 77, 0.5);
  cursor: pointer;
  transition: all 0.3s ease-in-out;
}
button.btn-glow:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(255, 77, 77, 0.8);
}

.spinner-ring {
  border: 5px solid rgba(255,255,255,0.1);
  border-left-color: #ff4d4d;
  height: 40px;
  width: 40px;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

    body {
  font-family: 'Inter', sans-serif;
  font-weight: 400;
  line-height: 1.6;
  background-color: #0d0d0d;
}

h2.section-title {
  font-size: 1.9rem;
  color: white;
  margin: 40px 0 20px;
  font-weight: 600;
  text-align: center;
}

@keyframes rainbowShift {
  0% { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}

.gradient-heading {
  background: linear-gradient(270deg, #ff4d4d, #ff9900, #4caf50, #2196f3, #9c27b0, #ff4d4d);
  background-size: 1200% 1200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbowShift 8s linear infinite;
  font-weight: 800;
  font-size: 2.8rem;
  text-align: center;
  margin-bottom: 10px;
}

    .section-title::after {
  content: '';
  display: block;
  width: 80px;
  margin: 10px auto 0;
  border-bottom: 3px solid #ff4d4d;
  box-shadow: 0 0 12px #ff4d4d;
}

    .blinker {
  animation: blink 1s steps(2, start) infinite;
}
@keyframes blink {
  to { visibility: hidden; }
}

    :root {
  --primary: #ff3d3d;
  --glass: rgba(255, 255, 255, 0.05);
  --blur: blur(12px);
  --radius: 18px;
  --shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
  --font: 'Inter', sans-serif;
}

.dashboard {
  padding: 60px 40px;
  display: flex;
  flex-direction: column;
  gap: 40px;
  font-family: var(--font);
}

h1, h2 {
  font-weight: 800;
  line-height: 1.2;
  color: white;
  text-align: center;
}

.glass-card {
  background: var(--glass);
  backdrop-filter: var(--blur);
  border-radius: var(--radius);
  padding: 30px;
  box-shadow: var(--shadow);
  border: 1px solid rgba(255, 255, 255, 0.08);
}

.cta-btn {
  background: var(--primary);
  color: white;
  padding: 14px 28px;
  border-radius: var(--radius);
  border: none;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 15px var(--primary);
  transition: 0.3s ease all;
}

.cta-btn:hover {
  background: #e83434;
  box-shadow: 0 0 25px var(--primary);
}

.practice-card {
  background: var(--glass);
  backdrop-filter: var(--blur);
  border-radius: var(--radius);
  padding: 25px;
  box-shadow: var(--shadow);
  transition: all 0.3s ease-in-out;
  border: 1px solid rgba(255,255,255,0.07);
}

.practice-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 24px rgba(255, 61, 61, 0.3);
}

.test-buttons button {
  background: var(--glass);
  border: 1px solid var(--primary);
  padding: 14px 28px;
  color: white;
  border-radius: var(--radius);
  font-size: 1rem;
  transition: all 0.3s ease;
}

.test-buttons button:hover {
  background: var(--primary);
  color: black;
}

.puzzle-section {
  background: var(--glass);
  padding: 20px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
}

@media (max-width: 768px) {
  .dashboard {
    padding: 30px 20px;
  }

  h1 {
    font-size: 2rem;
  }

  .cta-btn {
    width: 100%;
  }
}

/* === ROOT THEME VARIABLES === */
:root {
  --primary: #ff4d4d;
  --secondary: #111;
  --glass: rgba(255, 255, 255, 0.05);
  --blur: blur(16px);
  --radius: 20px;
  --font: 'Inter', sans-serif;
  --shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
  --transition: all 0.3s ease-in-out;
}

/* === BASE STYLING === */
body {
  margin: 0;
  font-family: var(--font);
  background-color: #0d0d0d;
  color: white;
  line-height: 1.6;
  overflow-x: hidden;
}

h1, h2, h3, h4 {
  font-weight: 700;
  text-align: center;
  line-height: 1.3;
  color: white;
  margin: 0.5em 0;
}

h1.gradient-heading {
  font-size: 2.8rem;
  background: linear-gradient(270deg, #ff4d4d, #ff9900, #4caf50, #2196f3, #9c27b0, #ff4d4d);
  background-size: 1200% 1200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbowShift 8s linear infinite;
}

/* === DASHBOARD CONTAINER === */
.dashboard {
  max-width: 1140px;
  margin: 60px auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 40px;
}

/* === GLASS CARDS === */
.glass-card, .glass-panel, .glass-chart-box {
  background: var(--glass);
  backdrop-filter: var(--blur);
  border-radius: var(--radius);
  padding: 30px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: var(--shadow);
  transition: var(--transition);
}

.glass-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 0 24px rgba(255, 77, 77, 0.4);
}

/* === BUTTONS === */
.btn-glow, .cta-btn, button {
  background: linear-gradient(90deg, #ff4d4d, #ff0080);
  color: white;
  border: none;
  padding: 14px 28px;
  border-radius: 999px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 0 12px rgba(255, 77, 77, 0.5);
  transition: var(--transition);
}

.btn-glow:hover, .cta-btn:hover, button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(255, 77, 77, 0.8);
}

/* === INPUTS & TEXTAREAS === */
input, textarea, select {
  width: 100%;
  padding: 12px;
  border-radius: var(--radius);
  background: #111;
  color: white;
  border: 1px solid #333;
  font-size: 1rem;
  margin-bottom: 15px;
  box-sizing: border-box;
}

/* === SECTIONS === */
.section-title {
  font-size: 1.8rem;
  color: white;
  position: relative;
  padding-bottom: 10px;
}

.section-title::after {
  content: '';
  display: block;
  width: 60px;
  margin: 10px auto 0;
  border-bottom: 3px solid var(--primary);
  box-shadow: 0 0 12px var(--primary);
}

/* === CARDS === */
.practice-card, .module-card {
  background: var(--glass);
  backdrop-filter: var(--blur);
  border-radius: var(--radius);
  padding: 24px;
  box-shadow: var(--shadow);
  border: 1px solid rgba(255, 255, 255, 0.07);
  transition: var(--transition);
  text-align: center;
}

.practice-card:hover, .module-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 24px rgba(255, 61, 61, 0.3);
}

/* === ROWS === */
.dashboard-row {
  display: flex;
  flex-wrap: wrap;
  gap: 30px;
  justify-content: center;
}

.dashboard-row .glass-card {
  flex: 1 1 320px;
  min-width: 280px;
}

/* === ANIMATIONS === */
@keyframes rainbowShift {
  0% { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}

/* === CHART CONTAINERS === */
.chart-box, .chart-container {
  width: 100%;
  max-width: 100%;
  overflow-x: auto;
}

/* === RESPONSIVE === */
@media (max-width: 768px) {
  .dashboard {
    padding: 20px 15px;
  }

  h1.gradient-heading {
    font-size: 2rem;
  }

  .btn-glow, .cta-btn {
    width: 100%;
  }

  .dashboard-row {
    flex-direction: column;
    gap: 20px;
  }
}

/* === PROFILE MENU === */
.profile-menu {
  position: absolute;
  top: 60px;
  right: 20px;
  background: #1a1a1a;
  border-radius: var(--radius);
  padding: 12px;
  box-shadow: var(--shadow);
  display: none;
}

.profile-menu p,
.profile-menu a,
.profile-menu button {
  margin: 10px 0;
  color: white;
  text-decoration: none;
  background: none;
  border: none;
  font: inherit;
  cursor: pointer;
}

/* === SPECIAL TEXT === */
.subtext {
  text-align: center;
  font-size: 1rem;
  color: #bbb;
  margin-bottom: 20px;
}

.typing-box {
  text-align: center;
  font-size: 1.2rem;
  color: white;
}

.cursor {
  display: inline-block;
  width: 2px;
  background: white;
  margin-left: 5px;
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

/* === MISC === */
.fade-in {
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}


/* ===== APPLE-INSPIRED POLISH STYLES ===== */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  color: #f5f5f7;
  background-color: #0c0c0c;
  letter-spacing: 0.02em;
  scroll-behavior: smooth;
}

.card {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 20px;
  backdrop-filter: blur(24px);
  box-shadow: 0 6px 30px rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  padding: 2rem;
  margin: 1rem auto;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(255, 255, 255, 0.08);
}

h1, h2, h3 {
  color: #ffffff;
  font-weight: 700;
  text-align: center;
  margin-bottom: 0.5em;
}

h2::after {
  content: "";
  display: block;
  width: 40px;
  height: 4px;
  background: linear-gradient(90deg, #ff416c, #ff4b2b);
  margin: 8px auto 0;
  border-radius: 2px;
}

.button, button {
  font-size: 1rem;
  font-weight: 600;
  padding: 12px 24px;
  border: none;
  border-radius: 999px;
  background: linear-gradient(to right, #ff416c, #ff4b2b);
  color: white;
  box-shadow: 0 4px 16px rgba(255, 65, 108, 0.3);
  cursor: pointer;
  transition: all 0.3s ease-in-out;
}

.button:hover, button:hover {
  transform: scale(1.04);
  box-shadow: 0 6px 24px rgba(255, 75, 43, 0.5);
}

input[type="text"], input[type="datetime-local"], input[type="number"], select, textarea {
  width: 100%;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 12px;
  color: #fff;
  margin-top: 8px;
  margin-bottom: 16px;
  font-size: 1rem;
  outline: none;
  transition: border-color 0.2s ease;
}

input:focus, textarea:focus, select:focus {
  border-color: #ff4b2b;
  background-color: rgba(255, 255, 255, 0.06);
}

.section-divider {
  width: 100%;
  height: 1px;
  background: linear-gradient(to right, transparent, #ff4b2b, transparent);
  margin: 2rem 0;
}

.stat-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  background: rgba(255, 255, 255, 0.04);
  padding: 1rem;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(255, 255, 255, 0.02);
}

.stat-box h3 {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.stat-box p {
  font-size: 0.9rem;
  color: #bbb;
}

.fade-in-up {
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInUp 0.6s ease-out forwards;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

::selection {
  background: #ff4b2b;
  color: white;
}

hr {
  border: 0;
  height: 1px;
  background: rgba(255, 255, 255, 0.1);
  margin: 3rem auto;
  width: 90%;
  max-width: 700px;
}

.gradient-glow {
  background: linear-gradient(to right, #ff416c, #ff4b2b);
  filter: drop-shadow(0 0 10px rgba(255, 65, 108, 0.4));
  border-radius: 999px;
}

 
 </style>
 
 
 
 </head>
 
   <!-- Apple-Style Navbar -->
 <header class="umbrixia-header">
   <div class="umbrixia-navbar">
     <div class="logo-area"><a href="index.html">Umbrixia</a></div>
     <nav class="nav-links">
       <a href="#why-umbrixia-apple">Features</a>
       <a href="signup.html">Free Demo</a>
      <a href="dashboard.html">Dashboard</a>
     </nav>
     <div class="nav-actions">
       <a href="login.html" class="btn-link">Login</a>
       <a href="signup.html" class="btn-solid">Get Started</a>
       <button onclick="toggleTheme()" class="theme-toggle">üåô</button>
     </div>
    </div>
    
     <div class="profile-icon" onclick="toggleProfileMenu()">üë§</div>
 <div id="profileMenu" class="profile-menu">
   <p id="userEmailDisplay">Loading...</p>
   <a href="settings.html">‚öôÔ∏è Settings</a>
   <button onclick="logout()">üö™ Logout</button>
 </div>

<script>
  firebase.auth().onAuthStateChanged(async u => {
    if (!u) return;
    const nameInput = document.getElementById("settings-name");
    nameInput.value = u.displayName || "";
    document.getElementById("save-settings").onclick = async () => {
      const newName = nameInput.value.trim();
      if (!newName) return alert("Name cannot be empty.");
      await u.updateProfile({ displayName: newName });
      alert("‚úÖ Display name updated.");
    };
  });
</script>

 
   </div>
 </header>
 
   <body class="dashboard-body">
   <div id="universal-loader">
   <div class="spinner"></div>
   <p style="color: white;">Loading Umbrixia...</p>
 </div>
 

    <h2 id="welcome-msg"></h2>

 <section class="intro-section-horizontal">
  <div class="dashboard-main-content">
  <div class="intro-left">
    <p class="subtext">Choose your test, challenge your mind, and unlock new possibilities.</p>
    <div class="typing-box">
      <span id="typed-text" class="typed-text"></span><span class="cursor">|</span>
    </div>
  </div>
  </div>
<div class="dashboard-main-content">
  <div class="intro-right">
    <div id="current-time" class="current-time"></div>
  </div>
</div>
</section>

    
   <div class="dashboard">
  <section class="dashboard-hero-glass">
  <div class="hero-content-wrapper">
   <div class="dashboard-main-content">
    <div class="hero-left">
      <h1 class="gradient-heading neon-text">üöÄ Umbrixia AI Dashboard</h1>
      <p class="hero-subtext">
        An intelligent platform built to unlock your academic potential with elegance and precision.
      </p>
      <div class="glow-line"></div>
    </div>
   </div>

   
<script>
  // Init Quill
  const quill = new Quill('#collab-editor', {
    modules: { toolbar: '#collab-toolbar' },
    theme: 'snow'
  });
  const notesRef = firebase.firestore().collection('notes').doc('shared');
  
  // Load existing and listen
  notesRef.onSnapshot(snap => {
    const data = snap.data() || {};
    quill.setContents(data.delta || {});
  });

  // Save on text-change
  quill.on('text-change', delta => {
    notesRef.set({ delta: quill.getContents() });
  });
</script>


  <script>
  // Redirect to login.html if not authenticated
  firebase.auth().onAuthStateChanged(user => {
    if (!user) {
      alert("‚ùå You must be logged in to access Umbrixia AI.");
      window.location.href = "login.html";
    }
  });
</script>

  <script>
  firebase.auth().onAuthStateChanged(async user => {
    if (!user) return;
    const doc = await firebase.firestore().collection("users").doc(user.uid).get();
    const data = doc.data() || {};
    // If no practice test taken AND no uploads, kick them out
    if (
      !data.hasTakenTest &&
      (!Array.isArray(data.essays)           || data.essays.length === 0) &&
      (!Array.isArray(data.recommendations)  || data.recommendations.length === 0) &&
      (!Array.isArray(data.transcripts)      || data.transcripts.length === 0) &&
      (!Array.isArray(data.extracurriculars) || data.extracurriculars.length === 0)
    ) {
      alert("‚ö†Ô∏è You must complete a practice test or upload materials before using Umbrixia.");
      window.location.href = "practice.html";  // or whichever page lets them start tests
    }
  });
</script>


 <script>
  firebase.auth().onAuthStateChanged(u => {
    if (!u) {
      alert("‚ùå Please log in to access Umbrixia.");
      window.location.href = "login.html";
    }
  });
</script>

   <div class="dashboard-row">

  <section class="glass-card fade-in">
  <h2 class="section-title">‚è±Ô∏è Pomodoro Timer</h2>
  <div id="pomodoro-display">25:00</div>
  <button id="pomodoro-start" class="btn-glow">Start</button>
  <button id="pomodoro-reset" class="btn-glow">Reset</button>
</section>

   </div>

<script>
  let pomodoroTime = 25 * 60, pomodoroInterval;
  const display = document.getElementById("pomodoro-display");
  function updateDisplay() {
    const m = String(Math.floor(pomodoroTime/60)).padStart(2,'0');
    const s = String(pomodoroTime%60).padStart(2,'0');
    display.textContent = `${m}:${s}`;
  }
  document.getElementById("pomodoro-start").onclick = () => {
    if (pomodoroInterval) return;
    pomodoroInterval = setInterval(() => {
      pomodoroTime--;
      updateDisplay();
      if (pomodoroTime <= 0) {
        clearInterval(pomodoroInterval);
        pomodoroInterval = null;
        new Notification("Pomodoro complete! Time for a 5-minute break.");
        pomodoroTime = 5*60; // short break
      }
    }, 1000);
  };
  document.getElementById("pomodoro-reset").onclick = () => {
    clearInterval(pomodoroInterval);
    pomodoroInterval = null;
    pomodoroTime = 25*60;
    updateDisplay();
  };
  updateDisplay();
  // Request permission for notifications
  if (Notification.permission !== "granted") Notification.requestPermission();
</script>

  <section class="glass-card fade-in">
  <h2 class="section-title">üìÜ Schedule Study Session</h2>
  <input type="text" id="cal-title" placeholder="Session Title" />
  <input type="datetime-local" id="cal-date" />
  <input type="number" id="cal-duration" placeholder="Duration (min)" />
  <button id="create-event" class="btn-glow">Create Calendar Event</button>
  <a id="event-link" class="btn-glow" style="display:none;" download="study.ics">Download .ics</a>
</section>

<script>
  document.getElementById("create-event").onclick = async () => {
    const title = document.getElementById("cal-title").value.trim();
    const date  = document.getElementById("cal-date").value;
    const dur   = parseInt(document.getElementById("cal-duration").value,10);
    if (!title||!date||!dur) return alert("Fill all fields.");
    const res = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/api/calendar-event",
      {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({title,date,duration:dur})
      }
    );
    const { href } = await res.json();
    const link = document.getElementById("event-link");
    link.href = href;
    link.style.display = "inline-block";
  };
</script>


  <script>
  if ("webkitSpeechRecognition" in window) {
    const recog = new webkitSpeechRecognition();
    recog.continuous = false;
    recog.onresult = e => {
      const text = e.results[0][0].transcript;
      document.getElementById("chat-input").value = text;
      document.getElementById("send-chat").click();
    };
    document.addEventListener("keydown", e => {
      if (e.key==="v" && e.altKey) recog.start();
    });
  }
</script>

    
    <div class="hero-right">
      <h2 class="section-title">üîé Explore Learning Modules</h2>
      <div class="learning-modules-horizontal">
        <div class="dashboard-main-content">
        <div class="module-card">
          <h3>üìÑ SHSAT Mastery</h3>
          <p>Targeted SHSAT drills with real-time feedback and AI tips.</p>
         <script>
  async function loadModules() {
    const uid = firebase.auth().currentUser.uid;
    const snap = await firebase
      .firestore()
      .collection("modules")
      .orderBy("order")
      .get();
    const container = document.querySelector(
      ".learning-modules-horizontal .dashboard-main-content"
    );
    container.innerHTML = "";
    snap.forEach(doc => {
      const { icon, title, description } = doc.data();
      const card = document.createElement("div");
      card.className = "module-card";
      card.innerHTML = `
        <h3>${icon} ${title}</h3>
        <p>${description}</p>
      `;
      container.appendChild(card);
    });
  }
  firebase.auth().onAuthStateChanged(u => u && loadModules());
</script>

        </div>
        </div>

 
        <div class="module-card">
         <div class="dashboard-main-content">
          <h3>üß© ISEE Explorer</h3>
          <p>Level-based question pools across Verbal, Quant, and Logic.</p>
         </div>
        </div>

        <div class="module-card">
         <div class="dashboard-main-content">
          <h3>üß† SAT Accelerator</h3>
          <p>Timed SAT sections with deep performance analysis.</p>
         </div>
        </div>
      </div>
    </div>
  </div>
</section>

</section>
     


 <h2 class="section-divider">üìä Analytics</h2>
     <section class="dashboard-analytics">
   <h2 class="section-title">üìä Performance Trends</h2>

    
 
   <div class="chart-row">
    <section class="performance-glass-panel">
  <div class="performance-content-wrapper">
    <div class="performance-left">
     <div class="dashboard-main-content">
      <h2 class="section-title gradient-heading">üìä Performance Trends</h2>
      <p class="hero-subtext">Track your real-time improvement powered by Umbrixia AI.</p>
      <div class="glow-line"></div>
     </div>
    </div>
  
    <div class="performance-right">
      <div class="chart-container">
        <div class="glass-chart-box">
          <canvas id="improvementChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</section>

    <section class="dashboard-demographics glass-card fade-in">
  <h2 class="section-title">üë• Demographic Trends</h2>
  <p class="hero-subtext">See how acceptance rates vary by demographic group.</p>
  <div class="chart-container">
    <canvas id="demographicChart"></canvas>
  </div>
</section>

    <div class="dashboard-row">

    <section class="glass-card fade-in">
  <h2 class="section-title">üìà Performance by Test Type</h2>
  <canvas id="byTestChart"></canvas>
</section>

    </div>

    <div class="dashboard-row">

    <section class="glass-card fade-in">
  <h2 class="section-title">üï∏Ô∏è Topic Radar</h2>
  <canvas id="topicRadar"></canvas>
</section>

    </div>

<script>
  async function drawTopicRadar() {
    const uid = firebase.auth().currentUser.uid;
    // get last test's topic breakdown
    const snap = await firebase.firestore()
      .collection('users').doc(uid).collection('scores')
      .orderBy('timestamp','desc').limit(1).get();
    const data = snap.docs[0]?.data()?.topics || {};
    const labels = Object.keys(data);
    const values = Object.values(data);

    new Chart(document.getElementById('topicRadar'), {
      type: 'radar',
      data: {
        labels,
        datasets: [{
          label: 'Topic Mastery',
          data: values,
          borderColor: '#ff9900',
          backgroundColor: 'rgba(255,153,0,0.2)'
        }]
      },
      options: { responsive: true, scales: { r: { beginAtZero:true } } }
    });
  }
  firebase.auth().onAuthStateChanged(u => u && drawTopicRadar());
</script>


    <section class="glass-card fade-in">
  <h2 class="section-title">üéØ Your Percentile Rank</h2>
  <p id="percentile-text">Calculating‚Ä¶</p>
</section>

<script>
  async function calculatePercentile() {
    const uid = firebase.auth().currentUser.uid;
    // Fetch all users' latest scores
    const allSnap = await firebase.firestore().collectionGroup("scores").get();
    const allScores = allSnap.docs.map(d => d.data().score);

    // Fetch your latest combined score (average of last SHSAT/ISEE/SAT)
    const userSnap = await firebase.firestore()
      .collection("users").doc(uid).collection("scores")
      .orderBy("timestamp","desc").limit(3).get(); // last one of each type
    const yourScores = userSnap.docs.map(d => d.data().score);
    if (yourScores.length===0) {
      return document.getElementById("percentile-text")
        .innerText = "No scores yet. Take a test first!";
    }
    const yourAvg = yourScores.reduce((a,b)=>a+b,0)/yourScores.length;

    // Compute percentile
    const better = allScores.filter(s => s < yourAvg).length;
    const percentile = Math.round((better / allScores.length) * 100);

    document.getElementById("percentile-text")
      .innerText = `You are in the top ${percentile}th percentile among all Umbrixia users!`;
  }
  firebase.auth().onAuthStateChanged(u => u && calculatePercentile());
</script>

    <button id="share-slack" class="btn-glow">Share Summary to Slack</button>

<script>
  document.getElementById('share-slack').onclick = async () => {
    const resultEl = document.getElementById('weekly-summary-result');
    const text = resultEl.textContent || resultEl.innerText;
    if (!text) return alert('Generate summary first.');
    try {
      await fetch('YOUR_SLACK_WEBHOOK_URL', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ text: `*Weekly Summary*\n${text}` })
      });
      alert('‚úÖ Shared to Slack!');
    } catch (e) {
      alert('‚ö†Ô∏è Slack share failed: ' + e.message);
    }
  };
</script>

    <div class="dashboard-row">
    
    <section class="glass-card fade-in">
  <h2 class="section-title">üîç AI Test Focus</h2>
  <p id="focus-recommendation">Generating recommendation‚Ä¶</p>
</section>

    </div>

    <button class="btn-glow elfi-btn" data-content-id="{{QUESTION_ID}}">
  üìñ Explain Like I‚Äôm 5
</button>
<div class="elfi-response" id="elfi-{{QUESTION_ID}}" style="display:none;"></div>


<script>
  async function recommendFocus() {
    const uid = firebase.auth().currentUser.uid;
    const snap = await firebase.firestore()
      .collection("users").doc(uid).collection("scores")
      .orderBy("timestamp","asc").get();
    const last = snap.docs[snap.docs.length-1]?.data();
    if (!last) {
      return document.getElementById("focus-recommendation")
        .innerText = "No recent test data.";
    }
    const prompt = `
Given this student‚Äôs last test result:
Type: ${last.type.toUpperCase()}, Score: ${last.score}
What single area should they focus on next (e.g. math, reading, time management) and why?
Respond in one sentence.
`;
    const comp = await openai.createChatCompletion({
      model: "gpt-4",
      messages:[{role:"user",content:prompt}]
    });
    document.getElementById("focus-recommendation").innerText =
      comp.data.choices[0].message.content.trim();
  }
  firebase.auth().onAuthStateChanged(u => u && recommendFocus());
</script>



<script>
  async function drawByTestChart() {
    const uid = firebase.auth().currentUser.uid;
    const snap = await firebase.firestore()
      .collection("users").doc(uid)
      .collection("scores")
      .orderBy("timestamp","asc")
      .get();

    const shsat    = [], isee = [], sat = [], labels = [];
    snap.forEach((doc,i) => {
      const d = doc.data();
      labels.push(`Test ${i+1}`);
      // assume each score doc has d.type ‚àà {"shsat","isee","sat"}
      if (d.type==="shsat") shsat.push(d.score);
      else if (d.type==="isee") isee.push(d.score);
      else if (d.type==="sat")  sat.push(d.score);
    });

    new Chart(document.getElementById("byTestChart"), {
      type: "line",
      data: {
        labels,
        datasets: [
          { label: "SHSAT", data: shsat, borderColor: "#ff4d4d", fill:false },
          { label: "ISEE",  data: isee,  borderColor: "#4caf50", fill:false },
          { label: "SAT",   data: sat,   borderColor: "#2196f3", fill:false }
        ]
      },
      options: { responsive: true }
    });
  }
  firebase.auth().onAuthStateChanged(u => u && drawByTestChart());
</script>

    <button id="export-pdf" class="btn-glow">Export Dashboard as PDF</button>
    <button id="export-csv" class="btn-glow">Export Scores as CSV</button>

<script>
  document.getElementById('export-csv').onclick = async () => {
    const uid = firebase.auth().currentUser.uid;
    const snap = await firebase.firestore()
      .collection('users').doc(uid).collection('scores')
      .orderBy('timestamp','asc').get();

    const rows = [['Date','Type','Math','ELA','Score']];
    snap.docs.forEach(doc => {
      const d = doc.data();
      const date = d.timestamp?.toDate().toISOString().slice(0,10) || '';
      const type = d.type || '';
      const math = d.math||'';
      const ela  = d.ela||'';
      const score= d.score||'';
      rows.push([date,type,math,ela,score]);
    });
    const csv = rows.map(r=>r.join(',')).join('\n');
    const blob = new Blob([csv],{type:'text/csv'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'scores.csv';
    link.click();
  };
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  document.getElementById("export-pdf").onclick = async () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit:"px", format:"a4" });
    await doc.html(document.body, {
      callback: () => doc.save("Umbrixia_Dashboard.pdf"),
      x:10, y:10, width: 800
    });
  };
</script>

<div class="dashboard-row">

    <section class="glass-card fade-in">
  <h2 class="section-title">üí¨ AI Study Chat</h2>
  <div id="chat-window" class="chat-window"></div>
  <div class="chat-input-wrapper">
    <input type="text" id="chat-input" placeholder="Ask your study question..." />
    <button id="send-chat" class="btn-glow">Send</button>
  </div>
</div>
</section>

    <section class="glass-card" id="flashcards">
  <h2 class="section-title">üìö AI Flashcards</h2>
  <p id="flashcard-topic" style="color:#ccc; font-size:.9rem;"></p>
  <div id="card-container" style="min-height:120px; padding:1rem; background:#111; border-radius:8px; color:white;"></div>
  <div style="margin-top:.5rem;">
    <button id="flip-card"  class="btn-glow">Flip</button>
    <button id="next-card"  class="btn-glow">Next</button>
  </div>
</section>

    <!-- FLASHCARDS -->
<section id="flashcards">
  <h2>üîñ Yours Spaced‚ÄëRepetition Flashcards</h2>
  <select id="flash-testType">
    <option value="isee">ISEE</option>
    <option value="shsat">SHSAT</option>
    <option value="sat">SAT</option>
  </select>
  <button id="load-flashcards" class="btn-glow">Load Flashcards</button>
  <div id="flashcard-container"></div>
</section>

<!-- ESSAY GRADER -->
<section id="essay-grader">
  <h2>üìù Essay Grader & Feedback</h2>
  <textarea id="essay-input" placeholder="Paste your essay‚Ä¶"></textarea>
  <button id="grade-essay" class="btn-glow">Grade Essay</button>
  <pre id="essay-result"></pre>
</section>

<!-- 30‚ÄëDAY PLAN -->
<section id="study-plan-30">
  <h2>üìÜ 30‚ÄëDay Study Plan</h2>
  <select id="plan-testType">
    <option value="isee">ISEE</option>
    <option value="shsat">SHSAT</option>
    <option value="sat">SAT</option>
  </select>
  <input id="daily-hours" type="number" placeholder="Hours per day" min="1" max="8"/>
  <button id="build-plan" class="btn-glow">Generate Plan</button>
  <ul id="plan-list"></ul>
</section>

<!-- SENTIMENT -->
<section id="sentiment">
  <h2>üí¨ Mood & Motivation</h2>
  <input id="sentiment-msg" placeholder="How are you feeling today?" />
  <button id="analyze-sentiment" class="btn-glow">Analyze Mood</button>
  <p id="sentiment-output"></p>
</section>


    <button id="voice-tutor" class="btn-glow">üé§ Talk to Tutor</button>
<audio id="voice-output" hidden></audio>

    <button id="flashcard-blitz" class="btn-glow">‚ö° Flashcard Blitz</button>
<div id="flashcard-modal" class="modal" style="display:none;">
  <div class="modal-content"><span id="close-flash">&times;</span>
    <div id="flashcard-question"></div>
    <button id="show-answer" class="btn-glow">Show Answer</button>
    <div id="flashcard-answer" style="display:none;"></div>
  </div>
</div>


    <section class="glass-card" id="ai-achievements">
  <h2 class="section-title">üèÜ AI Achievements & Streak</h2>
  <p>Your current streak: <strong id="streak-count">0</strong> days</p>
  <ul id="achievements-list" style="list-style:none; padding-left:0; color:white;"></ul>
</section>

    

    <div class="chart-box">
  <canvas id="forecastChart"></canvas>
</div>

    <section class="glass-card" id="ai-quiz">
  <h2 class="section-title">üìù AI Adaptive Quiz</h2>
  <p id="quiz-topic" style="color:#ccc; font-size:.9rem;"></p>
  <div id="quiz-container"></div>
  <button id="start-quiz" class="btn-glow">Start Quiz</button>
</section>

    <div class="dashboard-row">

    <section class="glass-card fade-in">
  <h2 class="section-title">üìß Draft Admissions Email</h2>
  <input type="email" id="email-to" placeholder="Recipient email" />
  <input type="text" id="email-subject" placeholder="Subject" />
  <textarea id="email-points" rows="4"
    placeholder="Key points, one per line"></textarea>
  <button id="draft-email" class="btn-glow">Draft Email</button>
  <div id="email-result" class="plan-result"></div>
</section>

    </div>

<script>
  document.getElementById('draft-email').onclick = async () => {
    const to = document.getElementById('email-to').value.trim();
    const subj = document.getElementById('email-subject').value.trim();
    const pts = document.getElementById('email-points').value
                .split('\n').map(l=>l.trim()).filter(l=>l);
    if(!to||!subj||!pts.length) return alert('Fill all fields.');
    const res = await fetch(
      'https://umbrixia-ai-github-io.onrender.com/api/email-draft',
      {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({recipient:to,subject:subj,points:pts})
      }
    );
    if(!res.ok) {
      const err = await res.json();
      return alert('Error: '+err.error);
    }
    const { body } = await res.json();
    document.getElementById('email-result').innerText = body;
  };
</script>


<script>
  document.getElementById("gen-flashcards").onclick = async () => {
    const text = document.getElementById("flashcard-source").value.trim();
    if (!text) return alert("Enter source text for flashcards.");
    const prompt = `
Given the following text, generate 5 Q&A flashcards in JSON:
"${text}"
Format:
[{ "question": "...", "answer": "..." }, ...]
`;
    const resp = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/chat",
      {
        method:"POST", headers:{"Content-Type":"application/json"},
        body:JSON.stringify({message: prompt})
      }
    );
    const {response} = await resp.json();
    let cards;
    try { cards = JSON.parse(response); }
    catch { return alert("Failed to parse flashcards."); }
    const container = document.getElementById("flashcard-container");
    container.innerHTML = "";
    cards.forEach(c => {
      const div = document.createElement("div");
      div.className = "flashcard";
      div.innerHTML = `<strong>Q:</strong> ${c.question}<br><em>A:</em> ${c.answer}`;
      container.appendChild(div);
    });
  };
</script>

    <div class="dashboard-row">

    <section class="glass-card fade-in">
  <h2 class="section-title">üìù Essay Feedback</h2>
  <textarea id="essay-input" rows="8" placeholder="Paste your essay here..."></textarea>
  <button id="essay-feedback-btn" class="btn-glow">Get Feedback</button>
  <div id="essay-feedback-result" class="feedback-result"></div>
</section>

    </div>

    <div class="dashboard-row">

    <section class="glass-card fade-in">
  <h2 class="section-title">üìö AI Study Plan</h2>
  <label>Goals (comma-separated):</label>
  <input type="text" id="plan-goals" placeholder="e.g. improve math, refine essays" />
  <label>Hours per week:</label>
  <input type="number" id="plan-hours" min="1" max="40" />
  <button id="generate-plan" class="btn-glow">Generate Plan</button>
  <pre id="study-plan-result" class="plan-result"></pre>
</section>

    </div>

    <div class="dashboard-row">

    <section class="glass-card fade-in">
  <h2 class="section-title">üöÄ Multi-Week Path</h2>
  <input type="text" id="lp-goal" placeholder="Your goal (e.g. 700 SAT)" />
  <input type="number" id="lp-weeks" placeholder="Weeks" min="1" />
  <button id="gen-path" class="btn-glow">Generate Path</button>
  <pre id="lp-result" class="plan-result"></pre>
</section>

    </div>

<script>
  document.getElementById("gen-path").onclick = async () => {
    const goal  = document.getElementById("lp-goal").value.trim();
    const weeks = parseInt(document.getElementById("lp-weeks").value,10);
    if (!goal||!weeks) return alert("Enter goal and weeks.");
    const res = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/api/learning-path",
      {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({goal,weeks})
      }
    );
    const { path } = await res.json();
    document.getElementById("lp-result").textContent =
      JSON.stringify(path,null,2);
  };
</script>

    <div class="dashboard-row">

    <section class="glass-card fade-in">
  <h2 class="section-title">‚úçÔ∏è Grammar Checker</h2>
  <textarea id="grammar-input" rows="4" placeholder="Paste text to proofread‚Ä¶"></textarea>
  <button id="grammar-check-btn" class="btn-glow">Check Grammar</button>
  <div id="grammar-output" class="proof-result"></div>
</section>

    </div>

    <div class="dashboard-row">

    <section class="glass-card fade-in">
  <h2 class="section-title">üîç AI Document Search</h2>
  <input type="text" id="doc-search-input" placeholder="Search your uploads‚Ä¶" />
  <button id="doc-search-btn" class="btn-glow">Search</button>
  <ul id="doc-search-results"></ul>
</section>

    </div>

<script>
  document.getElementById("doc-search-btn").onclick = async () => {
    const q = document.getElementById("doc-search-input").value.trim();
    if (!q) return alert("Enter a search term.");
    const uid = firebase.auth().currentUser.uid;
    const res = await fetch("https://umbrixia-ai-github-io.onrender.com/api/search-docs", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ uid, query: q })
    });
    const { results } = await res.json();
    const ul = document.getElementById("doc-search-results");
    ul.innerHTML = results.map(r => 
      `<li><strong>[${r.source}]</strong> ${r.excerpt}</li>`
    ).join("");
  };
</script>


<script>
  document.getElementById("grammar-check-btn").onclick = async () => {
    const text = document.getElementById("grammar-input").value.trim();
    if (!text) return alert("Please enter text.");
    const res = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/api/grammar-check",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text })
      }
    );
    if (!res.ok) {
      const err = await res.json();
      return alert("Error: " + err.error);
    }
    const { corrected, explanation } = await res.json();
    document.getElementById("grammar-output").innerHTML = `
      <h4>Corrected:</h4><p>${corrected}</p>
      <h4>Explanation:</h4><p>${explanation}</p>
    `;
  };
</script>

    <!-- Adaptive Drill -->
<section id="adaptive-drill">
  <h2>üß© Adaptive Drill</h2>
  <select id="drill-testType">
    <option value="isee">ISEE</option>
    <option value="shsat">SHSAT</option>
    <option value="sat">SAT</option>
  </select>
  <button id="get-adaptive" class="btn-glow">Get Adaptive Questions</button>
  <div id="adaptive-questions"></div>
</section>

<!-- Score Forecast -->
<section id="forecast">
  <h2>üîÆ Score Forecast</h2>
  <select id="forecast-testType">
    <option value="isee">ISEE</option>
    <option value="shsat">SHSAT</option>
    <option value="sat">SAT</option>
  </select>
  <button id="get-forecast" class="btn-glow">Forecast Next 5</button>
  <canvas id="forecastChart"></canvas>
  <ul id="forecast-recs"></ul>
</section>

<!-- Leaderboard -->
<section id="leaderboard">
  <h2>üèÜ Leaderboard</h2>
  <select id="leader-testType">
    <option value="isee">ISEE</option>
    <option value="shsat">SHSAT</option>
    <option value="sat">SAT</option>
  </select>
  <ol id="leader-list"></ol>
</section>

<input id="goals" placeholder="E.g. Raise SAT math to 750">
<button onclick="buildPlan()">üõ†Ô∏è Build Plan</button>
<div id="planDisplay"></div>
<button onclick="subscribe()">Subscribe Now</button>


<script>
  document.getElementById("generate-plan").onclick = async () => {
    const goals = document.getElementById("plan-goals").value.trim();
    const hours = document.getElementById("plan-hours").value;
    if (!goals || !hours) return alert("Please enter goals and hours.");
    const res = await fetch("https://umbrixia-ai-github-io.onrender.com/api/study-plan", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ goals, availableHoursPerWeek: hours })
    });
    if (!res.ok) {
      const err = await res.json();
      return alert("Error: " + err.error);
    }
    const { plan } = await res.json();
    document.getElementById("study-plan-result").textContent = JSON.stringify(plan, null, 2);
  };
</script>


<script>
  document.getElementById("essay-feedback-btn").onclick = async () => {
    const essay = document.getElementById("essay-input").value.trim();
    if (!essay) return alert("Please paste your essay.");
    const res = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/api/essay-feedback",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ essay })
      }
    );
    if (!res.ok) {
      const err = await res.json();
      return alert("Error: " + err.error);
    }
    const { feedback, suggestions } = await res.json();
    document.getElementById("essay-feedback-result").innerHTML = `
      <h4>Feedback:</h4><p>${feedback}</p>
      <h4>Suggestions:</h4><p>${suggestions}</p>
    `;
  };
</script>


<script>
  document.getElementById("send-chat").onclick = async () => {
    const input = document.getElementById("chat-input");
    const chatWindow = document.getElementById("chat-window");
    const msg = input.value.trim();
    if (!msg) return;
    chatWindow.innerHTML += `<p class="message user">${msg}</p>`;
    input.value = "";
    try {
      const res = await fetch(
        "https://umbrixia-ai-github-io.onrender.com/chat",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg }),
        }
      );
      const { response } = await res.json();
      chatWindow.innerHTML += `<p class="message bot">${response}</p>`;
      chatWindow.scrollTop = chatWindow.scrollHeight;
    } catch (e) {
      chatWindow.innerHTML += `<p class="message bot">Error: ${e.message}</p>`;
    }
  };
</script>




     <!-- Line Chart -->
     <div class="chart-box">
       <canvas id="improvementChart"></canvas>
       <script>
        
 firebase.auth().onAuthStateChanged(async (user) => {
   if (!user) return;
 
   const scoresRef = db.collection("users").doc(user.uid).collection("scores");
   const snapshot = await scoresRef.orderBy("timestamp", "asc").get();
 
   const mathScores = [];
   const elaScores = [];
   const labels = [];
 
   snapshot.forEach((doc, i) => {
     const data = doc.data();
     labels.push(`Test ${i + 1}`);
     mathScores.push(data.math || 0);
     elaScores.push(data.ela || 0);
   });
 
   if (labels.length === 0) {
   document.querySelector(".dashboard-analytics").innerHTML = `
     <div style="text-align: center; padding: 40px; color: #ccc;">
       <h2>üì≠ No test data found!</h2>
       <p>Let‚Äôs get you started with your first practice test:</p>
       <div style="margin-top: 20px;">
         <button onclick="showSection('shsat')" style="padding: 12px 24px; background-color: #ff4d4d; border: none; color: white; font-size: 1rem; border-radius: 10px; cursor: pointer;">üìù Start SHSAT Test</button>
         <button onclick="showSection('isee')" style="padding: 12px 24px; margin-left: 10px; background-color: #2196f3; border: none; color: white; font-size: 1rem; border-radius: 10px; cursor: pointer;">üìò Start ISEE Test</button>
         <button onclick="showSection('sat')" style="padding: 12px 24px; margin-left: 10px; background-color: #4caf50; border: none; color: white; font-size: 1rem; border-radius: 10px; cursor: pointer;">üéì Start SAT Test</button>
         target.classList.add("active");
       </div>
       
     </div>
   `;
   return;
 }
 
   target.classList.add("active");
 
   new Chart(document.getElementById("improvementChart"), {
     type: "line",
     data: {
       labels,
       datasets: [
         {
           label: "Math",
           data: mathScores,
           borderColor: "#ff4d4d",
           backgroundColor: "rgba(255,77,77,0.2)",
           tension: 0.4,
           fill: true,
           pointRadius: 4
         },
         {
           label: "ELA",
           data: elaScores,
           borderColor: "#ffc107",
           backgroundColor: "rgba(255,193,7,0.2)",
           tension: 0.4,
           fill: true,
           pointRadius: 4
         }
       ]
     },
     options: {
       responsive: true,
       plugins: {
         legend: { position: "top" },
         title: {
           display: true,
           text: "üìà Real Score Improvement",
           font: { size: 18 }
         }
       }
     }
   });
 
   // Pie chart
   const last = snapshot.docs[snapshot.docs.length - 1]?.data();
const topicData = last?.topics;

if (!topicData || Object.keys(topicData).length === 0) {
  document.getElementById("categoryPieChart").parentElement.innerHTML = `
    <div style="text-align: center; padding: 40px; color: #ccc;">
      <h2>üì≠ No topic breakdown available</h2>
      <p>Please complete a test that includes topic-tagged results.</p>
    </div>
  `;
  return;
}

 
   new Chart(document.getElementById("categoryPieChart"), {
     type: "pie",
     data: {
       labels: Object.keys(topicData),
       datasets: [{
         data: Object.values(topicData),
         backgroundColor: ["#ff4d4d", "#ffc107", "#4caf50", "#2196f3", "#9c27b0"],
         borderColor: "#111"
       }]
     },
     options: {
       plugins: {
         title: {
           display: true,
           text: "üß† Topic Strength Breakdown",
           font: { size: 18 }
         }
       }
     }
   });
 
 });
 </script>
 
       
 
     </div>
 
    
 
       <section id="admissions-predictor" class="glass-card">
  <h2 class="section-title">üîÆ AI Admissions Predictor</h2>
  <form id="admissions-form">
    <input
      id="predict-school"
      type="text"
      placeholder="Dream School (e.g. Harvard)"
      required 
    />
    <select id="predict-grade" required>
      <option value="" disabled selected>Grade Level</option>
      <option value="6">6th Grade</option>
      <option value="7">7th Grade</option>
      <option value="8">8th Grade</option>
      <option value="9">9th Grade</option>
      <option value="10">10th Grade</option>
      <option value="11">11th Grade</option>
      <option value="12">12th Grade</option>
    </select>
    <button type="submit" class="btn-glow">Predict</button>
  </form>
  <div id="predict-result" class="prediction-result" style="margin-top:1rem;"></div>
</section>

          <div class="upload-section">
    <h3>üìÇ Upload Your Materials</h3>
    <label>Essays (PDF or TXT):</label>
    <input type="file" id="upload-essays" multiple accept=".pdf,.txt" />
    <label>Recommendation Letters:</label>
    <input type="file" id="upload-recs" multiple accept=".pdf,.txt" />
    <label>Transcripts:</label>
    <input type="file" id="upload-transcripts" multiple accept=".pdf,.txt" />
    <label>Extracurriculars (images or PDF):</label>
    <input type="file" id="upload-extras" multiple accept=".pdf,.jpg,.png" />
  </div>
<script>
  // Upload handlers
  async function uploadFiles(field, files) {
    const uid = firebase.auth().currentUser.uid;
    const data = await Promise.all(Array.from(files).map(async file => {
      const text = await file.text();           // for PDFs you‚Äôd convert to text server-side
      return text;
    }));
    return firebase.firestore()
      .collection("users")
      .doc(uid)
      .set({ [field]: data }, { merge: true });
  }

  // Wire up the inputs
  document.getElementById("upload-essays")
    .addEventListener("change", e => uploadFiles("essays", e.target.files));
  document.getElementById("upload-recs")
    .addEventListener("change", e => uploadFiles("recommendations", e.target.files));
  document.getElementById("upload-transcripts")
    .addEventListener("change", e => uploadFiles("transcripts", e.target.files));
  document.getElementById("upload-extras")
    .addEventListener("change", e => uploadFiles("extracurriculars", e.target.files));
</script>

        <div class="upload-section">
  <h3>üìÇ Upload Your Materials</h3>
  <input type="file" id="upload-essays" multiple accept=".pdf,.txt" />
  <input type="file" id="upload-recs" multiple accept=".pdf,.txt" />
  <input type="file" id="upload-transcripts" multiple accept=".pdf,.txt" />
  <input type="file" id="upload-extras" multiple accept=".pdf,.jpg,.png" />
</div>

        <script>
async function runPrediction() {
  const school = document.getElementById("dream-school").value.trim();
  const grade  = document.getElementById("user-grade").value;
  const uid    = firebase.auth().currentUser.uid;
  const doc    = await firebase.firestore().collection("users").doc(uid).get();
  const data   = doc.data() || {};
  const essays           = data.essays           || [];
  const recommendations  = data.recommendations  || [];
  const transcripts      = data.transcripts      || [];
  const extracurriculars = data.extracurriculars || [];

  if (
    essays.length===0 && recommendations.length===0 &&
    transcripts.length===0 && extracurriculars.length===0
  ) {
    alert("‚ö†Ô∏è Please upload at least one material before predicting.");
    return;
  }

  const chanceEl        = document.getElementById("chance");
  const justificationEl = document.getElementById("justification");
  const suggestionEl    = document.getElementById("suggestion");
  chanceEl.textContent        = "üîÑ Predicting‚Ä¶";
  justificationEl.textContent = "";
  suggestionEl.textContent    = "";

  try {
    const resp = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/api/admissions-predict",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          school, grade,
          essays, recommendations,
          transcripts, extracurriculars
        })
      }
    );
    if (!resp.ok) throw new Error(await resp.text());
    const { chance, justification, suggestion } = await resp.json();
    chanceEl.textContent        = `üéØ ${chance}`;
    justificationEl.textContent = `üß† ${justification}`;
    suggestionEl.textContent    = `üìà ${suggestion}`;
  } catch (err) {
    chanceEl.textContent        = "‚ùå Prediction failed.";
    justificationEl.textContent = err.message;
    suggestionEl.textContent    = "";

     // ‚îÄ‚îÄ After displaying the AI result, save it to Firestore ‚îÄ‚îÄ
  const uid = firebase.auth().currentUser.uid;
  await firebase.firestore()
    .collection("users")
    .doc(uid)
    .collection("predictions")
    .add({
      school,
      chance, // the string like "72%"
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

   // After displaying the AI result:
const shareBtn = document.createElement("button");
shareBtn.className = "btn-glow";
shareBtn.textContent = "Share to Discord";
shareBtn.onclick = async () => {
  const school = document.getElementById("dream-school").value;
  const chance = document.getElementById("chance").innerText;
  const just   = document.getElementById("justification").innerText;
  const sug    = document.getElementById("suggestion").innerText;
  try {
    await fetch("YOUR_DISCORD_WEBHOOK_URL", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        content: `**Umbrixia Prediction**\nSchool: ${school}\n${chance}\n${just}\n${sug}`
      })
    });
    alert("‚úÖ Shared to Discord!");
  } catch (e) {
    alert("‚ö†Ô∏è Failed to share: " + e.message);
  }
};
document.getElementById("prediction-output").appendChild(shareBtn);

  }
}
</script>

    <div class="dashboard-row">

        <section class="glass-card fade-in">
  <h2 class="section-title">üïë Prediction History</h2>
  <table id="prediction-history">
    <thead>
      <tr><th>Date</th><th>School</th><th>Chance</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

    </div>

       <section class="glass-card" id="leaderboard">
  <h2 class="section-title">üèÜ Global Leaderboard</h2>
  <table id="leaderboard-table">
    <thead>
      <tr><th>Rank</th><th>User</th><th>Avg Score</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

    <!-- 17) Mood Tracker -->
<section class="glass-card">
  <h2 class="section-title">üòä Mood Check</h2>
  <textarea id="mood-entry" placeholder="How are you feeling today?" rows="3"></textarea>
  <button id="check-mood" class="btn-glow">Check Mood</button>
  <div id="mood-result"></div>
</section>

<!-- 18) Smart Scheduler -->
<section class="glass-card">
  <h2 class="section-title">üìÖ Smart Scheduler</h2>
  <input id="event-title" placeholder="Study: Algebra" />
  <input type="datetime-local" id="event-start" />
  <input type="number" id="event-duration" placeholder="Duration (mins)" />
  <button id="schedule-btn" class="btn-glow">Schedule & Sync</button>
</section>

<!-- 19) Peer Help Chatroom -->
<section class="glass-card">
  <h2 class="section-title">üí¨ Peer Help</h2>
  <input id="chat-room" placeholder="Room name (e.g. algebra)" />
  <button id="join-room" class="btn-glow">Join Room</button>
  <div id="chat-window" style="height:200px; overflow:auto; border:1px solid #444; padding:8px;"></div>
  <input id="chat-input" placeholder="Type your question..." />
  <button id="send-chat" class="btn-glow">Send</button>
</section>

<!-- 20) AI‚ÄëGenerated Tests -->
<section class="glass-card">
  <h2 class="section-title">üìù Generate Practice Test</h2>
  <input id="test-subject" placeholder="Subject (e.g. SAT Math)" />
  <input type="number" id="test-count" placeholder="Number of Qs" />
  <button id="make-test" class="btn-glow">Generate</button>
  <div id="test-container"></div>
</section>



        <div class="glass-card" id="badges">
  <h2 class="section-title">üéñ Your Badges</h2>
  <div id="badge-container"></div>
</div>

    <section class="glass-card">
  <h2 class="section-title">üì£ Share Your Progress</h2>
  <button id="share-twitter" class="btn-glow">Tweet My Score</button>
  <button id="share-linkedin" class="btn-glow">Share on LinkedIn</button>
</section>


<script>
  async function loadBadges() {
    const uid = firebase.auth().currentUser.uid;
    const snap = await firebase.firestore()
      .collection("users").doc(uid).collection("badges").get();
    const cont = document.getElementById("badge-container");
    cont.innerHTML = "";
    snap.forEach(doc => {
      const b = doc.data();
      const img = document.createElement("img");
      img.src = b.iconURL;
      img.alt = b.name;
      img.title = `${b.name}: ${b.description}`;
      img.className = "badge-icon";
      cont.appendChild(img);
    });
  }
  firebase.auth().onAuthStateChanged(u => u && loadBadges());
</script>

    <div class="dashboard-row">

        <!-- Focus Sessions -->
<section class="glass-card fade-in">
  <h2 class="section-title">‚è≥ Focus Sessions</h2>
  <canvas id="focusChart"></canvas>
</section>

    </div>

    <div class="dashboard-row">

        <section class="glass-card fade-in">
  <h2 class="section-title">üóíÔ∏è Weekly Summary</h2>
  <button id="generate-summary" class="btn-glow">Generate Weekly Summary</button>
  <div id="weekly-summary-result" class="plan-result"></div>
</section>

    </div>

<script>
  document.getElementById("generate-summary").onclick = async () => {
    const uid = firebase.auth().currentUser.uid;
    // Fetch the last 7 scores from Firestore
    const snap = await firebase
      .firestore()
      .collection("users")
      .doc(uid)
      .collection("scores")
      .orderBy("timestamp", "desc")
      .limit(7)
      .get();

    const scores = snap.docs.map(doc => {
      const d = doc.data();
      return { math: d.math || 0, ela: d.ela || 0, when: d.timestamp?.toDate()?.toLocaleDateString() };
    }).reverse(); // chronological

    if (scores.length === 0) {
      return alert("‚ö†Ô∏è No test data found. Complete a test first.");
    }

    // Show loading
    const resultEl = document.getElementById("weekly-summary-result");
    resultEl.textContent = "üîÑ Generating summary‚Ä¶";

    try {
      const resp = await fetch(
        "https://umbrixia-ai-github-io.onrender.com/api/weekly-summary",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ scores })
        }
      );
      if (!resp.ok) throw new Error(await resp.text());
      const { summary, recommendations, motivation } = await resp.json();
      resultEl.innerHTML = `
        <h4>Summary:</h4><p>${summary}</p>
        <h4>Recommendations:</h4>
        <ul>${recommendations.map(r => `<li>${r}</li>`).join("")}</ul>
        <h4>Motivation:</h4><p>${motivation}</p>
      `;
    } catch (e) {
      resultEl.textContent = "‚ùå Failed to generate summary.";
      console.error(e);
    }
  };
</script>


<script>
  let focusStart = null;
  // Track when user toggles Focus Mode (F key)
  document.addEventListener("keydown", (e) => {
    if (e.key.toLowerCase() === "f") {
      if (!document.body.classList.contains("focus-mode")) {
        focusStart = new Date();
      } else {
        const duration = (new Date() - focusStart) / 1000; // seconds
        firebase
          .firestore()
          .collection("users")
          .doc(firebase.auth().currentUser.uid)
          .collection("focusSessions")
          .add({
            start: firebase.firestore.Timestamp.fromDate(focusStart),
            duration,
          });
      }
    }
  });

  // Draw the focus chart
  async function drawFocusChart() {
    const snap = await firebase
      .firestore()
      .collection("users")
      .doc(firebase.auth().currentUser.uid)
      .collection("focusSessions")
      .orderBy("start", "asc")
      .get();
    const labels = [];
    const data = [];
    snap.forEach((doc) => {
      const { start, duration } = doc.data();
      labels.push(new Date(start.seconds * 1000).toLocaleDateString());
      data.push(duration / 60); // minutes
    });
    new Chart(document.getElementById("focusChart"), {
      type: "line",
      data: {
        labels,
        datasets: [
          {
            label: "Focus Time (min)",
            data,
            borderColor: "#2196f3",
            fill: false,
            tension: 0.2,
          },
        ],
      },
      options: { responsive: true },
    });
  }
  firebase.auth().onAuthStateChanged((u) => u && drawFocusChart());
</script>


<script>
  // Award 10 points for every prediction (append inside your runPrediction() after saving)
  // await firebase.firestore().collection('users').doc(uid)
  //   .set({ points: firebase.firestore.FieldValue.increment(10) }, { merge: true });

  // Load top 5 users by points
  async function loadLeaderboard() {
    const snap = await firebase
      .firestore()
      .collection("users")
      .orderBy("points", "desc")
      .limit(5)
      .get();
    const ol = document.getElementById("leaderboard");
    ol.innerHTML = "";
    snap.forEach((doc) => {
      const d = doc.data();
      const li = document.createElement("li");
      li.textContent = `${d.displayName || doc.id}: ${d.points || 0} pts`;
      ol.appendChild(li);
    });
  }
  firebase.auth().onAuthStateChanged((u) => u && loadLeaderboard());
</script>

    <div class="dashboard-row">

        <section class="glass-card fade-in">
  <h2 class="section-title">‚è∞ Study Reminders</h2>
  <label>Next Practice Date:</label>
  <input type="date" id="reminder-date" />
  <button id="set-reminder" class="btn-glow">Set Reminder</button>
</section>

    </div>

<script>
  document.getElementById("set-reminder").onclick = async () => {
    const date = document.getElementById("reminder-date").value;
    if (!date) return alert("Please pick a date.");
    const uid = firebase.auth().currentUser.uid;
    await firebase.firestore()
      .collection("users")
      .doc(uid)
      .set({ nextPractice: date }, { merge: true });
    alert("‚úÖ Reminder saved for " + date);
  };
</script>


<script>
async function loadPredictionHistory() {
  const uid = firebase.auth().currentUser.uid;
  const snapshot = await firebase.firestore()
    .collection("users")
    .doc(uid)
    .collection("predictions")
    .orderBy("timestamp", "desc")
    .get();

  const tbody = document.querySelector("#prediction-history tbody");
  tbody.innerHTML = "";
  snapshot.forEach(doc => {
    const { timestamp, school, chance } = doc.data();
    const date = timestamp
      ? new Date(timestamp.seconds * 1000).toLocaleString()
      : "‚Äì";
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${date}</td><td>${school}</td><td>${chance}</td>`;
    tbody.appendChild(tr);
  });
}

// Load history once the user is authenticated
firebase.auth().onAuthStateChanged(u => {
  if (u) loadPredictionHistory();
});
</script>



  <button class="btn-glow" onclick="runPrediction()">Predict</button>

  <div id="prediction-output" class="prediction-result">
    <p id="chance" class="gradient-score"></p>
    <p id="justification"></p>
    <p id="suggestion"></p>
  </div>
</section>

    <script>
async function runPrediction() {
  const school = document.getElementById("dream-school").value.trim();
  const grade  = document.getElementById("user-grade").value;
  const chanceEl       = document.getElementById("chance");
  const justificationEl = document.getElementById("justification");
  const suggestionEl   = document.getElementById("suggestion");

  // Show a loading message
  chanceEl.textContent        = "üîÑ Predicting your chance‚Ä¶";
  justificationEl.textContent = "";
  suggestionEl.textContent    = "";

  try {
    const resp = await fetch(
  "https://umbrixia-ai-github-io.onrender.com/api/admissions-predict",
  {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ school, grade, essays, recommendations, transcripts, extracurriculars })
  }
);
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ school, grade })
    });
    if (!resp.ok) throw new Error(await resp.text());

    const { chance, justification, suggestion } = await resp.json();
    chanceEl.textContent        = `üéØ ${chance}% chance`;
    justificationEl.textContent = `üß† ${justification}`;
    suggestionEl.textContent    = `üìà ${suggestion}`;
  } catch (err) {
    chanceEl.textContent        = "‚ùå Prediction failed.";
    justificationEl.textContent = err.message;
    suggestionEl.textContent    = "";
  }
}
</script>



 
 
    <div class="test-buttons">
  <button onclick="showSection('shsat')">SHSAT</button>
  <button onclick="showSection('isee')">ISEE</button>
  <button onclick="showSection('sat')">SAT</button>
</div>

     <!-- SHSAT Section -->
     <div id="shsat" class="test-section">
       <h2>SHSAT Practice Tests</h2>
       <div class="practice-grid">
         <div class="practice-card"><h3>Test 1</h3><p>Coming Soon...</p></div>
         <button onclick="markTestComplete()">Start Test</button>
         <div class="practice-card"><h3>Test 2</h3><p>Coming Soon...</p></div>
         <button onclick="markTestComplete()">Start Test</button>
         <div class="practice-card"><h3>Test 3</h3><p>Coming Soon...</p></div>
         <button onclick="markTestComplete()">Start Test</button>
       </div>
       <div class="puzzle-section">
         <h4>üß© SHSAT Puzzle of the Day</h4>
         <p id="puzzle-clue">Loading puzzle‚Ä¶</p>
<small id="puzzle-date"></small>
       </div>
     </div>

    <div class="dashboard-row">

      <section class="glass-card fade-in">
  <h2 class="section-title">‚úèÔ∏è Collaborative Notes</h2>
  <div id="collab-toolbar"></div>
  <div id="collab-editor" style="height:200px;"></div>
</section>

    </div>

    <div class="dashboard-row">

    <section class="glass-card fade-in">
  <h2 class="section-title">üìÖ Daily Check-in</h2>
  <p>Your current streak: <strong id="daily-streak">‚Ä¶</strong> days</p>
  <button id="checkin-btn" class="btn-glow">Check In</button>
</section>

    </div>

<script>
  document.getElementById("checkin-btn").onclick = async () => {
    const uid = firebase.auth().currentUser.uid;
    const ref = firebase.firestore().collection("users").doc(uid);
    const snap = await ref.get();
    const data = snap.data() || {};
    const today = new Date().toISOString().slice(0,10);
    if (data.lastCheckin === today) {
      alert("You've already checked in today!");
      return;
    }
    // calculate new streak
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate()-1);
    const yStr = yesterday.toISOString().slice(0,10);
    const streak = data.lastCheckin === yStr ? (data.streak||0)+1 : 1;
    await ref.set({ lastCheckin:today, streak }, { merge:true });
    document.getElementById("daily-streak").textContent = streak;
  };

  // load on auth
  firebase.auth().onAuthStateChanged(async u => {
    if (!u) return;
    const doc = await firebase.firestore().collection("users").doc(u.uid).get();
    const d = doc.data()||{};
    document.getElementById("daily-streak").textContent = d.streak||0;
  });
</script>

 
     <!-- ISEE Section -->
     <div id="isee" class="test-section">
       <h2>ISEE Practice Tests</h2>
       <div class="practice-grid">
         <div class="practice-card"><h3>Test 1</h3><p>Coming Soon...</p></div>
         <div class="practice-card"><h3>Test 2</h3><p>Coming Soon...</p></div>
         <div class="practice-card"><h3>Test 3</h3><p>Coming Soon...</p></div>
       </div>
       <div class="puzzle-section">
         <h4>üß† ISEE Logic Puzzle</h4>
         <p>‚ÄúI speak without a mouth and hear without ears. I have no body, but I come alive with wind.‚Äù</p>
         <small>Answer tomorrow.</small>
       </div>
     </div>
 
     <!-- SAT Section -->
     <div id="sat" class="test-section">
       <h2>SAT Practice Tests</h2>
       <div class="practice-grid">
         <div class="practice-card"><h3>Test 1</h3><p>Coming Soon...</p></div>
         <div class="practice-card"><h3>Test 2</h3><p>Coming Soon...</p></div>
         <div class="practice-card"><h3>Test 3</h3><p>Coming Soon...</p></div>
       </div>
       <div class="puzzle-section">
         <h4>üí° SAT Puzzle</h4>
         <p>‚ÄúI have keys but no locks. I have space but no room. You can enter but you can‚Äôt go outside. What am I?‚Äù</p>
         <small>Answer tomorrow.</small>
       </div>
     </div>
   </div>
 
   <script>
 function showSection(testId) {
   document.querySelectorAll('.test-section').forEach(section => {
     section.classList.remove('active');
     section.style.display = 'none';
   });
 
   const target = document.getElementById(testId);
   target.style.display = 'block';
 
   // Force reflow to allow animation on re-show
   void target.offsetWidth;
 
   target.classList.add('active');
 }
 </script>
 
 
 
 
 
 
  
   <script>
 firebase.auth().onAuthStateChanged(async (user) => {
   if (!user) return;
 
   const db = firebase.firestore();
   const scoresRef = db.collection("users").doc(user.uid).collection("scores");
   const snapshot = await scoresRef.orderBy("timestamp", "asc").get();
 
   const mathScores = [];
   const elaScores = [];
   const labels = [];
 
   snapshot.forEach((doc, i) => {
     const data = doc.data();
     labels.push(`Test ${i + 1}`);
     mathScores.push(data.math || 0);
     elaScores.push(data.ela || 0);
   });
 
   // Fallback if no tests taken
   if (labels.length === 0) {
     labels.push("No data");
     mathScores.push(0);
     elaScores.push(0);
   }
 
   // Draw Line Chart
   new Chart(document.getElementById("improvementChart"), {
     type: "line",
     data: {
       labels,
       datasets: [
         {
           label: "Math",
           data: mathScores,
           borderColor: "#ff4d4d",
           backgroundColor: "rgba(255, 77, 77, 0.2)",
           tension: 0.4,
           fill: true,
           pointRadius: 4
         },
         {
           label: "ELA",
           data: elaScores,
           borderColor: "#ffc107",
           backgroundColor: "rgba(255, 193, 7, 0.2)",
           tension: 0.4,
           fill: true,
           pointRadius: 4
         }
       ]
     },
     options: {
       responsive: true,
       plugins: {
         legend: { position: "top" },
         title: {
           display: true,
           text: "Score Improvement Over Time",
           font: { size: 18 }
         }
       }
     }
   });
 
   // Pie Chart (use last test's topics as placeholder)
   const last = snapshot.docs[snapshot.docs.length - 1]?.data();
   const topicData = last?.topics;
 if (!topicData) {
   console.warn("No topic data found. Skipping pie chart.");
   return;
 }
 
 
   new Chart(document.getElementById("categoryPieChart"), {
     type: "pie",
     data: {
       labels: Object.keys(topicData),
       datasets: [{
         data: Object.values(topicData),
         backgroundColor: ["#ff4d4d", "#ffc107", "#4caf50", "#2196f3", "#9c27b0"],
         borderColor: "#111"
       }]
     },
     options: {
       plugins: {
         title: {
           display: true,
           text: "Topic Strength Distribution",
           font: { size: 18 }
         }
       }
     }
   });
 
 });
 </script>
 
 
 <script>
 async function runPrediction() {
   const school = document.getElementById("dream-school").value;
   const grade = document.getElementById("user-grade").value;
   const email = firebase.auth().currentUser?.email || "unknown@example.com";
   const userId = firebase.auth().currentUser?.uid;
 
   const db = firebase.firestore();
   const userDoc = await db.collection("users").doc(userId).get();
   const hasTakenTest = userDoc.exists && userDoc.data().hasTakenTest;
 
   if (!hasTakenTest) {
     document.getElementById("chance").innerText = "‚ùå You need to complete a practice test first.";
     document.getElementById("justification").innerText = "üìò The AI needs test results to make an accurate prediction.";
     document.getElementById("suggestion").innerText = "üìù Please take a SHSAT, ISEE, or SAT test first.";
     return;
   }

  // ‚îÄ‚îÄ Real AI Predictor Call ‚îÄ‚îÄ
try {
  const resp = await fetch("/api/predict", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      school,
      grade,
      essays:           userDoc.data().essays,
      recommendations:  userDoc.data().recommendations,
      transcripts:      userDoc.data().transcripts,
      extracurriculars: userDoc.data().extracurriculars
    })
  });
  if (!resp.ok) throw new Error(await resp.text());
  const data = await resp.json();
  document.getElementById("chance").innerText        = `üîÆ ${data.chance}% chance`;
  document.getElementById("justification").innerText = data.justification;
  document.getElementById("suggestion").innerText    = data.suggestion;
} catch (err) {
  console.error("Prediction error:", err);
  alert("‚ö†Ô∏è Could not reach the AI predictor. Try again later.");
}

 
 
   const data = await res.json();
 
   document.getElementById("chance").innerText = `üéØ Acceptance Chance: ${data.chance}`;
   document.getElementById("justification").innerText = `üß† Why: ${data.justification}`;
   document.getElementById("suggestion").innerText = `üìà Focus On: ${data.suggestion}`;
 }
 
 </script>
 
   <script>
   function markTestComplete() {
  const user = firebase.auth().currentUser;
  if (!user) return;

  const db = firebase.firestore();
  db.collection("users").doc(user.uid).set({
    hasTakenTest: true
  }, { merge: true }).then(() => {
    confetti({
      particleCount: 100,
      spread: 70,
      origin: { y: 0.6 }
    });
  });
}

    function getGreeting() {
  const hour = new Date().getHours();
  if (hour < 12) return "‚òÄÔ∏è Good morning";
  if (hour < 18) return "üå§Ô∏è Good afternoon";
  return "üåô Good evening";
}

firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    const name = user.displayName || user.email.split("@")[0];
    const msg = document.getElementById("welcome-msg");
    if (msg) msg.textContent = `${getGreeting()}, ${name}!`;
  }
});

 
   </script>
   <script src="script.js" defer></script>
 <script>
   const firebaseConfig = {
     apiKey: "AIzaSyDDcAp59mkTutfXgnRIBWpVww3jFyzOtIc",
     authDomain: "umbrixia-d804f.firebaseapp.com",
     projectId: "umbrixia-d804f",
     storageBucket: "umbrixia-d804f.firebasestorage.app",
     messagingSenderId: "532093768601",
     appId: "1:532093768601:web:4e94149269d88213edb908"
   };
 
   const auth = firebase.auth();
   const db = firebase.firestore();
 </script>
 
 <script>
   window.addEventListener("load", () => {
     const loader = document.getElementById("universal-loader");
     if (loader) loader.style.display = "none";
   });
 </script>
 
 <script>
   const firebaseConfig = {
     apiKey: "AIzaSyDDcAp59mkTutfXgnRIBWpVww3jFyzOtIc",
     authDomain: "umbrixia-d804f.firebaseapp.com",
     projectId: "umbrixia-d804f",
     storageBucket: "umbrixia-d804f.firebasestorage.app",
     messagingSenderId: "532093768601",
     appId: "1:532093768601:web:4e94149269d88213edb908"
   };
 
   if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
   const auth = firebase.auth();
   const db = firebase.firestore();
 
   window.addEventListener("load", () => {
     const universalLoader = document.getElementById("universal-loader");
     const loginScreen = document.getElementById("loading-screen");
 
     auth.onAuthStateChanged((user) => {
  if (!user) {
  // Show a warning, then send them to login
  alert("‚ùå You must be logged in to access Umbrixia AI. Redirecting now‚Ä¶");
  window.location.href = "login.html";
  return;
} else {
  if (universalLoader) universalLoader.style.display = "none";
  if (loginScreen)    loginScreen.style.display    = "none";




         if (universalLoader) universalLoader.style.display = "none";
         if (loginScreen) loginScreen.style.display = "none";
 
         const name = user.displayName || user.email.split("@")[0];
         const emailEl = document.getElementById("userEmailDisplay");
         if (emailEl) emailEl.textContent = user.email;
       }
     });
   });
 </script>
 
   <script>
   function toggleProfileMenu() {
     const menu = document.getElementById("profileMenu");
     if (menu.style.display === "block") {
       menu.style.display = "none";
     } else {
       menu.style.display = "block";
     }
   }
 
   function logout() {
     firebase.auth().signOut().then(() => {
       window.location.href = "login.html";
     });
   }
 </script>
 
   <script>
   setInterval(() => {
     const now = new Date();
     document.getElementById("current-time").textContent = now.toLocaleString();
   }, 1000);
 </script>


    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1"></script>

    <script>
     document.querySelectorAll('button').forEach(btn => {
  btn.addEventListener('click', () => {
    if (navigator.vibrate) navigator.vibrate(30);
  });
});
    </script>

    <canvas id="background-particles"></canvas>
<script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
<script>
tsParticles.load("background-particles", {
  fullScreen: { enable: true, zIndex: -1 },
  background: { color: "#0d0d0d" },
  particles: {
    number: { value: 60 },
    color: { value: "#ff4d4d" },
    shape: { type: "circle" },
    opacity: { value: 0.4 },
    size: { value: 3 },
    move: { enable: true, speed: 0.5 },
  }
});
</script>

    <script>
const texts = [
  "Achieve your dream score.",
  "Get into your dream school.",
  "Train smarter with AI.",
];
let i = 0, j = 0, current = "", isDeleting = false;

function type() {
  current = texts[i];
  const display = document.getElementById("typed-text");
  display.innerText = current.slice(0, j);
  if (!isDeleting && j < current.length) {
    j++;
  } else if (isDeleting && j > 0) {
    j--;
  } else {
    isDeleting = !isDeleting;
    if (!isDeleting) i = (i + 1) % texts.length;
  }
  setTimeout(type, isDeleting ? 40 : 100);
}
type();

     snapshot.forEach((doc, i) => {
  const data = doc.data();

  if (typeof data.math !== "number" || typeof data.ela !== "number") {
    console.warn("Invalid score format:", data);
  }

  labels.push(`Test ${i + 1}`);
  mathScores.push(typeof data.math === "number" ? data.math : 0);
  elaScores.push(typeof data.ela === "number" ? data.ela : 0);
});

<script>
// ‚Äî SECTION TOGGLE ‚Äî
function showSection(id) {
  document.querySelectorAll('.test-section').forEach(s => s.style.display = 'none');
  document.getElementById(id).style.display = 'block';
}

// ‚Äî CHART.JS PERFORMANCE TRENDS ‚Äî
auth.onAuthStateChanged(async user => {
  if (!user) return;
  const snap = await db.collection('users')
    .doc(user.uid).collection('scores')
    .orderBy('timestamp','asc').get();
  const labels = [], math = [], ela = [];
  snap.forEach((doc,i) => {
    labels.push(`Test ${i+1}`);
    math.push(doc.data().math || 0);
    ela.push(doc.data().ela || 0);
  });
  new Chart(document.getElementById('improvementChart'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'Math', data: math },
      { label: 'ELA',  data: ela  }
    ] }
  });
});

// ‚Äî AI ADMISSIONS PREDICTOR ‚Äî
async function runPrediction() {
  const school = document.getElementById('dream-school').value;
  const grade  = document.getElementById('user-grade').value;
  const user   = auth.currentUser;
  if (!user) return alert('üö™ Please log in first.');

  const userDoc = await db.collection('users').doc(user.uid).get();
  if (!userDoc.exists || !userDoc.data().hasTakenTest) {
    document.getElementById('chance').innerText = '‚ùå Take a practice test first.';
    document.getElementById('justification').innerText = 'üìò AI needs test results.';
    document.getElementById('suggestion').innerText    = 'üìù Start SHSAT, ISEE or SAT.';
    return;
  }

  try {
    const resp = await fetch('/api/predict', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        school,
        grade,
        essays:          userDoc.data().essays || [],
        recommendations: userDoc.data().recommendations || [],
        transcripts:     userDoc.data().transcripts || [],
        extracurriculars:userDoc.data().extracurriculars || []
      })
    });
    if (!resp.ok) throw new Error(await resp.text());
    const { chance, justification, suggestion } = await resp.json();
    document.getElementById('chance').innerText        = `üîÆ ${chance}% chance`;
    document.getElementById('justification').innerText = justification;
    document.getElementById('suggestion').innerText    = suggestion;
  } catch (e) {
    console.error(e);
    alert('‚ö†Ô∏è AI predictor failed‚Äîtry again later.');
  }
}
</script>


</script>

<script>
async function runPrediction() {
  const school = document.getElementById("dream-school").value.trim();
  const grade  = document.getElementById("user-grade").value;
  const essays = userDoc.data()?.essays  || [];
  const recs   = userDoc.data()?.recommendations || [];
  const trans  = userDoc.data()?.transcripts || [];
  const extras = userDoc.data()?.extracurriculars || [];

  // ‚îÄ‚îÄ AUTO-KILL IF NO DATA ‚îÄ‚îÄ
  if (
    essays.length === 0 &&
    recs.length   === 0 &&
    trans.length  === 0 &&
    extras.length === 0
  ) {
    // You can replace this alert with a custom modal if you have one
    alert(
      "‚ö†Ô∏è You haven‚Äôt taken any tests or uploaded your essays/recs/transcripts yet.\n" +
      "Please complete a practice test and upload your documents before predicting."
    );
    return;  // stop here
  }

  const chanceEl        = document.getElementById("chance");
  const justificationEl = document.getElementById("justification");
  const suggestionEl    = document.getElementById("suggestion");

  // show loading
  chanceEl.textContent        = "üîÑ Predicting your chance‚Ä¶";
  justificationEl.textContent = "";
  suggestionEl.textContent    = "";

  try {
    const resp = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/api/admissions-predict",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          school,
          grade,
          essays,
          recommendations: recs,
          transcripts:     trans,
          extracurriculars: extras
        })
      }
    );
    if (!resp.ok) throw new Error(await resp.text());

    const { chance, justification, suggestion } = await resp.json();
    chanceEl.textContent        = `üéØ ${chance}`;
    justificationEl.textContent = `üß† ${justification}`;
    suggestionEl.textContent    = `üìà ${suggestion}`;
  } catch (err) {
    chanceEl.textContent        = "‚ùå Prediction failed.";
    justificationEl.textContent = err.message;
    suggestionEl.textContent    = "";
  }
}
</script>

      <script>
  async function drawDemographics() {
    const resp = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/api/demographic-trends"
    );
    if (!resp.ok) return console.error("Demo trends failed");

    const data = await resp.json();
    // data format: { labels: [...], values: [...] }
    new Chart(document.getElementById("demographicChart"), {
      type: "bar",
      data: {
        labels: data.labels,
        datasets: [{
          label: "Acceptance Rate (%)",
          data: data.values,
          backgroundColor: "#4caf50"
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, max: 100 }
        }
      }
    });
  }

  // Run on page load once logged in
  firebase.auth().onAuthStateChanged(user => {
    if (user) drawDemographics();
  });
</script>

      <script>
async function drawDemographics() {
  try {
    const resp = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/api/demographic-trends"
    );
    if (!resp.ok) throw new Error("Demographics fetch failed");
    const { labels, values } = await resp.json();
    new Chart(document.getElementById("demographicChart"), {
      type: "bar",
      data: { labels, datasets:[{ label:"Acceptance Rate (%)", data:values, backgroundColor:"#4caf50" }] },
      options:{ responsive:true }
    });
  } catch(e){ console.error(e); }
}
firebase.auth().onAuthStateChanged(u => u && drawDemographics());
</script>

      <script>
  async function loadPuzzle(testId) {
    const doc = await firebase
      .firestore()
      .collection("puzzles")
      .doc(testId)
      .get();
    const data = doc.data() || {};
    document.getElementById("puzzle-clue").innerText =
      data.clue || "No puzzle available.";
    document.getElementById("puzzle-date").innerText =
      data.answerDate
        ? `Answer on ${new Date(data.answerDate.seconds * 1000).toLocaleDateString()}`
        : "";
  }
  // Load the puzzle for the currently visible test section
  document.querySelectorAll(".test-buttons button").forEach(btn =>
    btn.addEventListener("click", () => loadPuzzle(btn.textContent.toLowerCase()))
  );
  // On page load, default to SHSAT
  firebase.auth().onAuthStateChanged(u => u && loadPuzzle("shsat"));
</script>

    <div class="dashboard-row">

      <section class="glass-card fade-in">
  <h2 class="section-title">‚úèÔ∏è Whiteboard</h2>
  <canvas id="whiteboard" width="600" height="400" style="border:1px solid #333;"></canvas>
</section>

    </div>

<script>
  const canvas = document.getElementById("whiteboard");
  const ctx = canvas.getContext("2d");
  let drawing=false;
  canvas.addEventListener("mousedown",()=>drawing=true);
  canvas.addEventListener("mouseup",()=>drawing=false);
  canvas.addEventListener("mousemove", e => {
    if (!drawing) return;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left, y = e.clientY - rect.top;
    ctx.fillRect(x,y,2,2);
    // Broadcast to Firestore
    firebase.firestore()
      .collection("whiteboard")
      .add({ x, y, t: firebase.firestore.FieldValue.serverTimestamp() });
  });
  // Listen to updates
  firebase.firestore()
    .collection("whiteboard")
    .orderBy("t","asc")
    .onSnapshot(snap => {
      snap.docChanges().forEach(c => {
        if (c.type==="added") {
          const { x,y } = c.doc.data();
          ctx.fillRect(x,y,2,2);
        }
      });
    });
</script>

    <div class="dashboard-row">

      <section class="glass-card fade-in">
  <h2 class="section-title">üó∫Ô∏è Mind-Map</h2>
  <div id="mindmap-container" class="mindmap"></div>
</section>

    </div>

<script>
  const mmRef = firebase.firestore().collection("mindmap");
  const container = document.getElementById("mindmap-container");

  // Add node on double-click
  container.addEventListener("dblclick", e => {
    const rect = container.getBoundingClientRect();
    const x = e.clientX - rect.left, y = e.clientY - rect.top;
    mmRef.add({ x, y, text: "New Node", t: firebase.firestore.FieldValue.serverTimestamp() });
  });

  // Render nodes & listen for changes
  mmRef.orderBy("t","asc").onSnapshot(snap => {
    container.innerHTML = "";
    snap.docs.forEach(doc => {
      const { x,y,text } = doc.data();
      const n = document.createElement("div");
      n.className = "mm-node";
      n.style.left = x + "px";
      n.style.top  = y + "px";
      n.textContent = text;
      container.appendChild(n);
    });
  });
</script>

    <script>
  firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
      const name = user.displayName || user.email;
      const greeting = document.createElement("div");
      greeting.innerHTML = `<h3>üëã Welcome, ${name}</h3>`;
      document.body.insertBefore(greeting, document.body.firstChild);
    }
  });
</script>

    <script>
  document.getElementById("voice-tutor").addEventListener("click", () => {
    const message = "Hi! I'm your AI Tutor. What subject do you want help with today?";
    const synth = window.speechSynthesis;
    const utterance = new SpeechSynthesisUtterance(message);
    synth.speak(utterance);
  });
</script>

      

 </body>
 </html>
