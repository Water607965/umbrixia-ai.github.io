<!DOCTYPE html>
 <html lang="en">
 <head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <title>Umbrixia | Dashboard</title>
   <link rel="stylesheet" href="styles.css" />
   <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
   <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
   <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
  // Redirect to login.html if not authenticated
  firebase.auth().onAuthStateChanged(user => {
    if (!user) {
      alert("‚ùå You must be logged in to access Umbrixia AI.");
      window.location.href = "login.html";
    }
  });
</script>

 <script>
  firebase.auth().onAuthStateChanged(u => {
    if (!u) {
      alert("‚ùå Please log in to access Umbrixia.");
      window.location.href = "login.html";
    }
  });
</script>

 
 
   <style>
     body {
       margin: 0;
       font-family: 'Inter', sans-serif;
       background-color: #0d0d0d;
       color: white;
     }

    .dashboard {
  width: 100%;
  padding: 60px 40px;
  margin: 0;
  display: flex;
  flex-direction: row; /* ‚Üê Important change */
  flex-wrap: wrap;
  gap: 40px;
  box-sizing: border-box;
}


     h1 {
       font-size: 2.8rem;
       text-align: center;
       color: #ff4d4d;
       margin-bottom: 10px;
     }
     .sub {
       text-align: center;
       font-size: 1.1rem;
       color: #999;
       margin-bottom: 40px;
     }
     .test-buttons {
       display: flex;
       justify-content: center;
       gap: 20px;
       flex-wrap: wrap;
       margin-bottom: 40px;
     }
     .test-buttons button {
       background-color: #111;
       border: 1px solid #ff4d4d;
       padding: 15px 30px;
       font-size: 1rem;
       color: white;
       border-radius: 12px;
       cursor: pointer;
       transition: 0.2s ease;
     }
     .test-buttons button:hover {
       background-color: #ff4d4d;
       color: #0d0d0d;
     }
     .test-section {
       display: none;
       animation: fadeIn 0.4s ease;
     }
     .practice-grid {
       display: grid;
       grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
       gap: 25px;
       margin-bottom: 50px;
     }
     .practice-card {
       background: #111;
       border: 1px solid #222;
       padding: 25px;
       border-radius: 14px;
       box-shadow: 0 0 10px #191919;
       text-align: center;
       transition: 0.2s ease;
     }
     .practice-card:hover {
       box-shadow: 0 0 15px #ff4d4d;
     }
     .practice-card h3 {
       color: #ff4d4d;
     }
     .puzzle-section {
       margin-top: 30px;
       background-color: #141414;
       padding: 20px;
       border-radius: 14px;
       box-shadow: 0 0 8px #181818;
     }
     .puzzle-section h4 {
       color: #ff4d4d;
     }
     @keyframes fadeIn {
       from { opacity: 0; transform: translateY(10px); }
       to { opacity: 1; transform: translateY(0); }
     }
   </style>
   <style>
   #loading-screen {
     position: fixed;
     inset: 0;
     background: #0d0d0d;
     display: flex;
     justify-content: center;
     align-items: center;
     z-index: 9999;
     font-size: 1.5rem;
     color: white;
     font-weight: bold;
     animation: fadeIn 0.3s ease-in-out;
   }
 
     h1 {
   background: linear-gradient(90deg, #ff4d4d, #ff9900, #4caf50, #2196f3, #9c27b0);
   -webkit-background-clip: text;
   color: transparent;
   font-weight: 800;
 }
    @media (max-width: 600px) {
  .dashboard {
    padding: 20px 10px;
  }
  h1.gradient-heading {
    font-size: 2rem;
  }
  .glass-card {
    padding: 20px;
  }
}

 
 </style>
 
   <style>
   #universal-loader {
     position: fixed;
     inset: 0;
     background: #0d0d0d;
     z-index: 9999;
     display: flex;
     flex-direction: column;
     justify-content: center;
     align-items: center;
     animation: fadeIn 0.4s ease-in-out;
   }
 
   .spinner {
     border: 5px solid #333;
     border-top: 5px solid #ff4d4d;
     border-radius: 50%;
     width: 60px;
     height: 60px;
     animation: spin 1s linear infinite;
     margin-bottom: 16px;
   }
 
   @keyframes spin {
     to { transform: rotate(360deg); }
   }

    .dashboard {
  max-width: 880px;
  margin: 60px auto;
  padding: 0 20px;
}

    .glass-card {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(12px);
  border-radius: 18px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
  padding: 30px;
  transition: all 0.3s ease-in-out;
}
.glass-card:hover {
  box-shadow: 0 12px 30px rgba(255, 77, 77, 0.4);
  transform: translateY(-2px);
}

    button.btn-glow {
  background: linear-gradient(90deg, #ff4d4d, #ff0080);
  border: none;
  color: white;
  padding: 14px 30px;
  font-size: 1rem;
  border-radius: 999px;
  box-shadow: 0 0 12px rgba(255, 77, 77, 0.5);
  cursor: pointer;
  transition: all 0.3s ease-in-out;
}
button.btn-glow:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(255, 77, 77, 0.8);
}

.spinner-ring {
  border: 5px solid rgba(255,255,255,0.1);
  border-left-color: #ff4d4d;
  height: 40px;
  width: 40px;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

    body {
  font-family: 'Inter', sans-serif;
  font-weight: 400;
  line-height: 1.6;
  background-color: #0d0d0d;
}

h2.section-title {
  font-size: 1.9rem;
  color: white;
  margin: 40px 0 20px;
  font-weight: 600;
  text-align: center;
}

@keyframes rainbowShift {
  0% { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}

.gradient-heading {
  background: linear-gradient(270deg, #ff4d4d, #ff9900, #4caf50, #2196f3, #9c27b0, #ff4d4d);
  background-size: 1200% 1200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbowShift 8s linear infinite;
  font-weight: 800;
  font-size: 2.8rem;
  text-align: center;
  margin-bottom: 10px;
}

    .section-title::after {
  content: '';
  display: block;
  width: 80px;
  margin: 10px auto 0;
  border-bottom: 3px solid #ff4d4d;
  box-shadow: 0 0 12px #ff4d4d;
}

    .blinker {
  animation: blink 1s steps(2, start) infinite;
}
@keyframes blink {
  to { visibility: hidden; }
}

    


 
 </style>
 
 
 
 </head>
 
   <!-- Apple-Style Navbar -->
 <header class="umbrixia-header">
   <div class="umbrixia-navbar">
     <div class="logo-area"><a href="index.html">Umbrixia</a></div>
     <nav class="nav-links">
       <a href="#why-umbrixia-apple">Features</a>
       <a href="signup.html">Free Demo</a>
      <a href="dashboard.html">Dashboard</a>
     </nav>
     <div class="nav-actions">
       <a href="login.html" class="btn-link">Login</a>
       <a href="signup.html" class="btn-solid">Get Started</a>
       <button onclick="toggleTheme()" class="theme-toggle">üåô</button>
     </div>
    </div>
    
     <div class="profile-icon" onclick="toggleProfileMenu()">üë§</div>
 <div id="profileMenu" class="profile-menu">
   <p id="userEmailDisplay">Loading...</p>
   <a href="settings.html">‚öôÔ∏è Settings</a>
   <button onclick="logout()">üö™ Logout</button>
 </div>
 
   </div>
 </header>
 
   <body class="dashboard-body">
   <div id="universal-loader">
   <div class="spinner"></div>
   <p style="color: white;">Loading Umbrixia...</p>
 </div>
 
 
 <section class="intro-section-horizontal">
  <div class="dashboard-main-content">
  <div class="intro-left">
    <p class="subtext">Choose your test, challenge your mind, and unlock new possibilities.</p>
    <div class="typing-box">
      <span id="typed-text" class="typed-text"></span><span class="cursor">|</span>
    </div>
  </div>
  </div>
<div class="dashboard-main-content">
  <div class="intro-right">
    <div id="current-time" class="current-time"></div>
  </div>
</div>
</section>

    
   <div class="dashboard">
  <section class="dashboard-hero-glass">
  <div class="hero-content-wrapper">
   <div class="dashboard-main-content">
    <div class="hero-left">
      <h1 class="gradient-heading neon-text">üöÄ Umbrixia AI Dashboard</h1>
      <p class="hero-subtext">
        An intelligent platform built to unlock your academic potential with elegance and precision.
      </p>
      <div class="glow-line"></div>
    </div>
   </div>

    
    <div class="hero-right">
      <h2 class="section-title">üîé Explore Learning Modules</h2>
      <div class="learning-modules-horizontal">
        <div class="dashboard-main-content">
        <div class="module-card">
          <h3>üìÑ SHSAT Mastery</h3>
          <p>Targeted SHSAT drills with real-time feedback and AI tips.</p>
        </div>
        </div>

 
        <div class="module-card">
         <div class="dashboard-main-content">
          <h3>üß© ISEE Explorer</h3>
          <p>Level-based question pools across Verbal, Quant, and Logic.</p>
         </div>
        </div>

        <div class="module-card">
         <div class="dashboard-main-content">
          <h3>üß† SAT Accelerator</h3>
          <p>Timed SAT sections with deep performance analysis.</p>
         </div>
        </div>
      </div>
    </div>
  </div>
</section>

</section>
     


 
     <section class="dashboard-analytics">
   <h2 class="section-title">üìä Performance Trends</h2>

    
 
   <div class="chart-row">
    <section class="performance-glass-panel">
  <div class="performance-content-wrapper">
    <div class="performance-left">
     <div class="dashboard-main-content">
      <h2 class="section-title gradient-heading">üìä Performance Trends</h2>
      <p class="hero-subtext">Track your real-time improvement powered by Umbrixia AI.</p>
      <div class="glow-line"></div>
     </div>
    </div>
  
    <div class="performance-right">
      <div class="chart-container">
        <div class="glass-chart-box">
          <canvas id="improvementChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</section>

    <section class="dashboard-demographics glass-card fade-in">
  <h2 class="section-title">üë• Demographic Trends</h2>
  <p class="hero-subtext">See how acceptance rates vary by demographic group.</p>
  <div class="chart-container">
    <canvas id="demographicChart"></canvas>
  </div>
</section>



     <!-- Line Chart -->
     <div class="chart-box">
       <canvas id="improvementChart"></canvas>
       <script>
        
 firebase.auth().onAuthStateChanged(async (user) => {
   if (!user) return;
 
   const scoresRef = db.collection("users").doc(user.uid).collection("scores");
   const snapshot = await scoresRef.orderBy("timestamp", "asc").get();
 
   const mathScores = [];
   const elaScores = [];
   const labels = [];
 
   snapshot.forEach((doc, i) => {
     const data = doc.data();
     labels.push(`Test ${i + 1}`);
     mathScores.push(data.math || 0);
     elaScores.push(data.ela || 0);
   });
 
   if (labels.length === 0) {
   document.querySelector(".dashboard-analytics").innerHTML = `
     <div style="text-align: center; padding: 40px; color: #ccc;">
       <h2>üì≠ No test data found!</h2>
       <p>Let‚Äôs get you started with your first practice test:</p>
       <div style="margin-top: 20px;">
         <button onclick="showSection('shsat')" style="padding: 12px 24px; background-color: #ff4d4d; border: none; color: white; font-size: 1rem; border-radius: 10px; cursor: pointer;">üìù Start SHSAT Test</button>
         <button onclick="showSection('isee')" style="padding: 12px 24px; margin-left: 10px; background-color: #2196f3; border: none; color: white; font-size: 1rem; border-radius: 10px; cursor: pointer;">üìò Start ISEE Test</button>
         <button onclick="showSection('sat')" style="padding: 12px 24px; margin-left: 10px; background-color: #4caf50; border: none; color: white; font-size: 1rem; border-radius: 10px; cursor: pointer;">üéì Start SAT Test</button>
         target.classList.add("active");
       </div>
       
     </div>
   `;
   return;
 }
 
   target.classList.add("active");
 
   new Chart(document.getElementById("improvementChart"), {
     type: "line",
     data: {
       labels,
       datasets: [
         {
           label: "Math",
           data: mathScores,
           borderColor: "#ff4d4d",
           backgroundColor: "rgba(255,77,77,0.2)",
           tension: 0.4,
           fill: true,
           pointRadius: 4
         },
         {
           label: "ELA",
           data: elaScores,
           borderColor: "#ffc107",
           backgroundColor: "rgba(255,193,7,0.2)",
           tension: 0.4,
           fill: true,
           pointRadius: 4
         }
       ]
     },
     options: {
       responsive: true,
       plugins: {
         legend: { position: "top" },
         title: {
           display: true,
           text: "üìà Real Score Improvement",
           font: { size: 18 }
         }
       }
     }
   });
 
   // Pie chart
   const last = snapshot.docs[snapshot.docs.length - 1]?.data();
const topicData = last?.topics;

if (!topicData || Object.keys(topicData).length === 0) {
  document.getElementById("categoryPieChart").parentElement.innerHTML = `
    <div style="text-align: center; padding: 40px; color: #ccc;">
      <h2>üì≠ No topic breakdown available</h2>
      <p>Please complete a test that includes topic-tagged results.</p>
    </div>
  `;
  return;
}

 
   new Chart(document.getElementById("categoryPieChart"), {
     type: "pie",
     data: {
       labels: Object.keys(topicData),
       datasets: [{
         data: Object.values(topicData),
         backgroundColor: ["#ff4d4d", "#ffc107", "#4caf50", "#2196f3", "#9c27b0"],
         borderColor: "#111"
       }]
     },
     options: {
       plugins: {
         title: {
           display: true,
           text: "üß† Topic Strength Breakdown",
           font: { size: 18 }
         }
       }
     }
   });
 
 });
 </script>
 
       
 
     </div>
 
    
 
       <section class="glass-card">
  <h2 class="section-title">üîÆ AI Admissions Predictor</h2>
  <input id="dream-school" placeholder="Dream School (e.g. Harvard)" />
  <select id="user-grade">
    <option value="6">6th Grade</option>
    <option value="7">7th Grade</option>
    <option value="8">8th Grade</option>
    <option value="9">9th Grade</option>
    <option value="10">10th Grade</option>
    <option value="11">11th Grade</option>
    <option value="12">12th Grade</option>
  </select>
          <div class="upload-section">
    <h3>üìÇ Upload Your Materials</h3>
    <label>Essays (PDF or TXT):</label>
    <input type="file" id="upload-essays" multiple accept=".pdf,.txt" />
    <label>Recommendation Letters:</label>
    <input type="file" id="upload-recs" multiple accept=".pdf,.txt" />
    <label>Transcripts:</label>
    <input type="file" id="upload-transcripts" multiple accept=".pdf,.txt" />
    <label>Extracurriculars (images or PDF):</label>
    <input type="file" id="upload-extras" multiple accept=".pdf,.jpg,.png" />
  </div>
<script>
  // Upload handlers
  async function uploadFiles(field, files) {
    const uid = firebase.auth().currentUser.uid;
    const data = await Promise.all(Array.from(files).map(async file => {
      const text = await file.text();           // for PDFs you‚Äôd convert to text server-side
      return text;
    }));
    return firebase.firestore()
      .collection("users")
      .doc(uid)
      .set({ [field]: data }, { merge: true });
  }

  // Wire up the inputs
  document.getElementById("upload-essays")
    .addEventListener("change", e => uploadFiles("essays", e.target.files));
  document.getElementById("upload-recs")
    .addEventListener("change", e => uploadFiles("recommendations", e.target.files));
  document.getElementById("upload-transcripts")
    .addEventListener("change", e => uploadFiles("transcripts", e.target.files));
  document.getElementById("upload-extras")
    .addEventListener("change", e => uploadFiles("extracurriculars", e.target.files));
</script>

  <button class="btn-glow" onclick="runPrediction()">Predict</button>

  <div id="prediction-output" class="prediction-result">
    <p id="chance" class="gradient-score"></p>
    <p id="justification"></p>
    <p id="suggestion"></p>
  </div>
</section>

    <script>
async function runPrediction() {
  const school = document.getElementById("dream-school").value.trim();
  const grade  = document.getElementById("user-grade").value;
  const chanceEl       = document.getElementById("chance");
  const justificationEl = document.getElementById("justification");
  const suggestionEl   = document.getElementById("suggestion");

  // Show a loading message
  chanceEl.textContent        = "üîÑ Predicting your chance‚Ä¶";
  justificationEl.textContent = "";
  suggestionEl.textContent    = "";

  try {
    const resp = await fetch(
  "https://umbrixia-ai-github-io.onrender.com/api/admissions-predict",
  {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ school, grade, essays, recommendations, transcripts, extracurriculars })
  }
);
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ school, grade })
    });
    if (!resp.ok) throw new Error(await resp.text());

    const { chance, justification, suggestion } = await resp.json();
    chanceEl.textContent        = `üéØ ${chance}% chance`;
    justificationEl.textContent = `üß† ${justification}`;
    suggestionEl.textContent    = `üìà ${suggestion}`;
  } catch (err) {
    chanceEl.textContent        = "‚ùå Prediction failed.";
    justificationEl.textContent = err.message;
    suggestionEl.textContent    = "";
  }
}
</script>



 
 
    <div class="test-buttons">
  <button onclick="showSection('shsat')">SHSAT</button>
  <button onclick="showSection('isee')">ISEE</button>
  <button onclick="showSection('sat')">SAT</button>
</div>

     <!-- SHSAT Section -->
     <div id="shsat" class="test-section">
       <h2>SHSAT Practice Tests</h2>
       <div class="practice-grid">
         <div class="practice-card"><h3>Test 1</h3><p>Coming Soon...</p></div>
         <button onclick="markTestComplete()">Start Test</button>
         <div class="practice-card"><h3>Test 2</h3><p>Coming Soon...</p></div>
         <button onclick="markTestComplete()">Start Test</button>
         <div class="practice-card"><h3>Test 3</h3><p>Coming Soon...</p></div>
         <button onclick="markTestComplete()">Start Test</button>
       </div>
       <div class="puzzle-section">
         <h4>üß© SHSAT Puzzle of the Day</h4>
         <p>‚ÄúYou measure my life in hours and I serve you by expiring. I‚Äôm quick when I‚Äôm thin and slow when I‚Äôm fat. The wind is my enemy.‚Äù</p>
         <small>Answer tomorrow.</small>
       </div>
     </div>
 
     <!-- ISEE Section -->
     <div id="isee" class="test-section">
       <h2>ISEE Practice Tests</h2>
       <div class="practice-grid">
         <div class="practice-card"><h3>Test 1</h3><p>Coming Soon...</p></div>
         <div class="practice-card"><h3>Test 2</h3><p>Coming Soon...</p></div>
         <div class="practice-card"><h3>Test 3</h3><p>Coming Soon...</p></div>
       </div>
       <div class="puzzle-section">
         <h4>üß† ISEE Logic Puzzle</h4>
         <p>‚ÄúI speak without a mouth and hear without ears. I have no body, but I come alive with wind.‚Äù</p>
         <small>Answer tomorrow.</small>
       </div>
     </div>
 
     <!-- SAT Section -->
     <div id="sat" class="test-section">
       <h2>SAT Practice Tests</h2>
       <div class="practice-grid">
         <div class="practice-card"><h3>Test 1</h3><p>Coming Soon...</p></div>
         <div class="practice-card"><h3>Test 2</h3><p>Coming Soon...</p></div>
         <div class="practice-card"><h3>Test 3</h3><p>Coming Soon...</p></div>
       </div>
       <div class="puzzle-section">
         <h4>üí° SAT Puzzle</h4>
         <p>‚ÄúI have keys but no locks. I have space but no room. You can enter but you can‚Äôt go outside. What am I?‚Äù</p>
         <small>Answer tomorrow.</small>
       </div>
     </div>
   </div>
 
   <script>
 function showSection(testId) {
   document.querySelectorAll('.test-section').forEach(section => {
     section.classList.remove('active');
     section.style.display = 'none';
   });
 
   const target = document.getElementById(testId);
   target.style.display = 'block';
 
   // Force reflow to allow animation on re-show
   void target.offsetWidth;
 
   target.classList.add('active');
 }
 </script>
 
 
 
 
 
 
  
   <script>
 firebase.auth().onAuthStateChanged(async (user) => {
   if (!user) return;
 
   const db = firebase.firestore();
   const scoresRef = db.collection("users").doc(user.uid).collection("scores");
   const snapshot = await scoresRef.orderBy("timestamp", "asc").get();
 
   const mathScores = [];
   const elaScores = [];
   const labels = [];
 
   snapshot.forEach((doc, i) => {
     const data = doc.data();
     labels.push(`Test ${i + 1}`);
     mathScores.push(data.math || 0);
     elaScores.push(data.ela || 0);
   });
 
   // Fallback if no tests taken
   if (labels.length === 0) {
     labels.push("No data");
     mathScores.push(0);
     elaScores.push(0);
   }
 
   // Draw Line Chart
   new Chart(document.getElementById("improvementChart"), {
     type: "line",
     data: {
       labels,
       datasets: [
         {
           label: "Math",
           data: mathScores,
           borderColor: "#ff4d4d",
           backgroundColor: "rgba(255, 77, 77, 0.2)",
           tension: 0.4,
           fill: true,
           pointRadius: 4
         },
         {
           label: "ELA",
           data: elaScores,
           borderColor: "#ffc107",
           backgroundColor: "rgba(255, 193, 7, 0.2)",
           tension: 0.4,
           fill: true,
           pointRadius: 4
         }
       ]
     },
     options: {
       responsive: true,
       plugins: {
         legend: { position: "top" },
         title: {
           display: true,
           text: "Score Improvement Over Time",
           font: { size: 18 }
         }
       }
     }
   });
 
   // Pie Chart (use last test's topics as placeholder)
   const last = snapshot.docs[snapshot.docs.length - 1]?.data();
   const topicData = last?.topics;
 if (!topicData) {
   console.warn("No topic data found. Skipping pie chart.");
   return;
 }
 
 
   new Chart(document.getElementById("categoryPieChart"), {
     type: "pie",
     data: {
       labels: Object.keys(topicData),
       datasets: [{
         data: Object.values(topicData),
         backgroundColor: ["#ff4d4d", "#ffc107", "#4caf50", "#2196f3", "#9c27b0"],
         borderColor: "#111"
       }]
     },
     options: {
       plugins: {
         title: {
           display: true,
           text: "Topic Strength Distribution",
           font: { size: 18 }
         }
       }
     }
   });
 
 });
 </script>
 
 
 <script>
 async function runPrediction() {
   const school = document.getElementById("dream-school").value;
   const grade = document.getElementById("user-grade").value;
   const email = firebase.auth().currentUser?.email || "unknown@example.com";
   const userId = firebase.auth().currentUser?.uid;
 
   const db = firebase.firestore();
   const userDoc = await db.collection("users").doc(userId).get();
   const hasTakenTest = userDoc.exists && userDoc.data().hasTakenTest;
 
   if (!hasTakenTest) {
     document.getElementById("chance").innerText = "‚ùå You need to complete a practice test first.";
     document.getElementById("justification").innerText = "üìò The AI needs test results to make an accurate prediction.";
     document.getElementById("suggestion").innerText = "üìù Please take a SHSAT, ISEE, or SAT test first.";
     return;
   }

  // ‚îÄ‚îÄ Real AI Predictor Call ‚îÄ‚îÄ
try {
  const resp = await fetch("/api/predict", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      school,
      grade,
      essays:           userDoc.data().essays,
      recommendations:  userDoc.data().recommendations,
      transcripts:      userDoc.data().transcripts,
      extracurriculars: userDoc.data().extracurriculars
    })
  });
  if (!resp.ok) throw new Error(await resp.text());
  const data = await resp.json();
  document.getElementById("chance").innerText        = `üîÆ ${data.chance}% chance`;
  document.getElementById("justification").innerText = data.justification;
  document.getElementById("suggestion").innerText    = data.suggestion;
} catch (err) {
  console.error("Prediction error:", err);
  alert("‚ö†Ô∏è Could not reach the AI predictor. Try again later.");
}

 
 
   const data = await res.json();
 
   document.getElementById("chance").innerText = `üéØ Acceptance Chance: ${data.chance}`;
   document.getElementById("justification").innerText = `üß† Why: ${data.justification}`;
   document.getElementById("suggestion").innerText = `üìà Focus On: ${data.suggestion}`;
 }
 
 </script>
 
   <script>
   function markTestComplete() {
  const user = firebase.auth().currentUser;
  if (!user) return;

  const db = firebase.firestore();
  db.collection("users").doc(user.uid).set({
    hasTakenTest: true
  }, { merge: true }).then(() => {
    confetti({
      particleCount: 100,
      spread: 70,
      origin: { y: 0.6 }
    });
  });
}

    function getGreeting() {
  const hour = new Date().getHours();
  if (hour < 12) return "‚òÄÔ∏è Good morning";
  if (hour < 18) return "üå§Ô∏è Good afternoon";
  return "üåô Good evening";
}

firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    const name = user.displayName || user.email.split("@")[0];
    const msg = document.getElementById("welcome-msg");
    if (msg) msg.textContent = `${getGreeting()}, ${name}!`;
  }
});

 
   </script>
   <script src="script.js" defer></script>
 <script>
   const firebaseConfig = {
     apiKey: "AIzaSyDDcAp59mkTutfXgnRIBWpVww3jFyzOtIc",
     authDomain: "umbrixia-d804f.firebaseapp.com",
     projectId: "umbrixia-d804f",
     storageBucket: "umbrixia-d804f.firebasestorage.app",
     messagingSenderId: "532093768601",
     appId: "1:532093768601:web:4e94149269d88213edb908"
   };
 
   const auth = firebase.auth();
   const db = firebase.firestore();
 </script>
 
 <script>
   window.addEventListener("load", () => {
     const loader = document.getElementById("universal-loader");
     if (loader) loader.style.display = "none";
   });
 </script>
 
 <script>
   const firebaseConfig = {
     apiKey: "AIzaSyDDcAp59mkTutfXgnRIBWpVww3jFyzOtIc",
     authDomain: "umbrixia-d804f.firebaseapp.com",
     projectId: "umbrixia-d804f",
     storageBucket: "umbrixia-d804f.firebasestorage.app",
     messagingSenderId: "532093768601",
     appId: "1:532093768601:web:4e94149269d88213edb908"
   };
 
   if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
   const auth = firebase.auth();
   const db = firebase.firestore();
 
   window.addEventListener("load", () => {
     const universalLoader = document.getElementById("universal-loader");
     const loginScreen = document.getElementById("loading-screen");
 
     auth.onAuthStateChanged((user) => {
  if (!user) {
  // Show a warning, then send them to login
  alert("‚ùå You must be logged in to access Umbrixia AI. Redirecting now‚Ä¶");
  window.location.href = "login.html";
  return;
} else {
  if (universalLoader) universalLoader.style.display = "none";
  if (loginScreen)    loginScreen.style.display    = "none";




         if (universalLoader) universalLoader.style.display = "none";
         if (loginScreen) loginScreen.style.display = "none";
 
         const name = user.displayName || user.email.split("@")[0];
         const emailEl = document.getElementById("userEmailDisplay");
         if (emailEl) emailEl.textContent = user.email;
       }
     });
   });
 </script>
 
   <script>
   function toggleProfileMenu() {
     const menu = document.getElementById("profileMenu");
     if (menu.style.display === "block") {
       menu.style.display = "none";
     } else {
       menu.style.display = "block";
     }
   }
 
   function logout() {
     firebase.auth().signOut().then(() => {
       window.location.href = "login.html";
     });
   }
 </script>
 
   <script>
   setInterval(() => {
     const now = new Date();
     document.getElementById("current-time").textContent = now.toLocaleString();
   }, 1000);
 </script>


    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1"></script>

    <script>
     document.querySelectorAll('button').forEach(btn => {
  btn.addEventListener('click', () => {
    if (navigator.vibrate) navigator.vibrate(30);
  });
});
    </script>

    <canvas id="background-particles"></canvas>
<script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
<script>
tsParticles.load("background-particles", {
  fullScreen: { enable: true, zIndex: -1 },
  background: { color: "#0d0d0d" },
  particles: {
    number: { value: 60 },
    color: { value: "#ff4d4d" },
    shape: { type: "circle" },
    opacity: { value: 0.4 },
    size: { value: 3 },
    move: { enable: true, speed: 0.5 },
  }
});
</script>

    <script>
const texts = [
  "Achieve your dream score.",
  "Get into your dream school.",
  "Train smarter with AI.",
];
let i = 0, j = 0, current = "", isDeleting = false;

function type() {
  current = texts[i];
  const display = document.getElementById("typed-text");
  display.innerText = current.slice(0, j);
  if (!isDeleting && j < current.length) {
    j++;
  } else if (isDeleting && j > 0) {
    j--;
  } else {
    isDeleting = !isDeleting;
    if (!isDeleting) i = (i + 1) % texts.length;
  }
  setTimeout(type, isDeleting ? 40 : 100);
}
type();

     snapshot.forEach((doc, i) => {
  const data = doc.data();

  if (typeof data.math !== "number" || typeof data.ela !== "number") {
    console.warn("Invalid score format:", data);
  }

  labels.push(`Test ${i + 1}`);
  mathScores.push(typeof data.math === "number" ? data.math : 0);
  elaScores.push(typeof data.ela === "number" ? data.ela : 0);
});

<script>
// ‚Äî SECTION TOGGLE ‚Äî
function showSection(id) {
  document.querySelectorAll('.test-section').forEach(s => s.style.display = 'none');
  document.getElementById(id).style.display = 'block';
}

// ‚Äî CHART.JS PERFORMANCE TRENDS ‚Äî
auth.onAuthStateChanged(async user => {
  if (!user) return;
  const snap = await db.collection('users')
    .doc(user.uid).collection('scores')
    .orderBy('timestamp','asc').get();
  const labels = [], math = [], ela = [];
  snap.forEach((doc,i) => {
    labels.push(`Test ${i+1}`);
    math.push(doc.data().math || 0);
    ela.push(doc.data().ela || 0);
  });
  new Chart(document.getElementById('improvementChart'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'Math', data: math },
      { label: 'ELA',  data: ela  }
    ] }
  });
});

// ‚Äî AI ADMISSIONS PREDICTOR ‚Äî
async function runPrediction() {
  const school = document.getElementById('dream-school').value;
  const grade  = document.getElementById('user-grade').value;
  const user   = auth.currentUser;
  if (!user) return alert('üö™ Please log in first.');

  const userDoc = await db.collection('users').doc(user.uid).get();
  if (!userDoc.exists || !userDoc.data().hasTakenTest) {
    document.getElementById('chance').innerText = '‚ùå Take a practice test first.';
    document.getElementById('justification').innerText = 'üìò AI needs test results.';
    document.getElementById('suggestion').innerText    = 'üìù Start SHSAT, ISEE or SAT.';
    return;
  }

  try {
    const resp = await fetch('/api/predict', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        school,
        grade,
        essays:          userDoc.data().essays || [],
        recommendations: userDoc.data().recommendations || [],
        transcripts:     userDoc.data().transcripts || [],
        extracurriculars:userDoc.data().extracurriculars || []
      })
    });
    if (!resp.ok) throw new Error(await resp.text());
    const { chance, justification, suggestion } = await resp.json();
    document.getElementById('chance').innerText        = `üîÆ ${chance}% chance`;
    document.getElementById('justification').innerText = justification;
    document.getElementById('suggestion').innerText    = suggestion;
  } catch (e) {
    console.error(e);
    alert('‚ö†Ô∏è AI predictor failed‚Äîtry again later.');
  }
}
</script>


</script>

<script>
async function runPrediction() {
  const school = document.getElementById("dream-school").value.trim();
  const grade  = document.getElementById("user-grade").value;
  const essays = userDoc.data()?.essays  || [];
  const recs   = userDoc.data()?.recommendations || [];
  const trans  = userDoc.data()?.transcripts || [];
  const extras = userDoc.data()?.extracurriculars || [];

  // ‚îÄ‚îÄ AUTO-KILL IF NO DATA ‚îÄ‚îÄ
  if (
    essays.length === 0 &&
    recs.length   === 0 &&
    trans.length  === 0 &&
    extras.length === 0
  ) {
    // You can replace this alert with a custom modal if you have one
    alert(
      "‚ö†Ô∏è You haven‚Äôt taken any tests or uploaded your essays/recs/transcripts yet.\n" +
      "Please complete a practice test and upload your documents before predicting."
    );
    return;  // stop here
  }

  const chanceEl        = document.getElementById("chance");
  const justificationEl = document.getElementById("justification");
  const suggestionEl    = document.getElementById("suggestion");

  // show loading
  chanceEl.textContent        = "üîÑ Predicting your chance‚Ä¶";
  justificationEl.textContent = "";
  suggestionEl.textContent    = "";

  try {
    const resp = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/api/admissions-predict",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          school,
          grade,
          essays,
          recommendations: recs,
          transcripts:     trans,
          extracurriculars: extras
        })
      }
    );
    if (!resp.ok) throw new Error(await resp.text());

    const { chance, justification, suggestion } = await resp.json();
    chanceEl.textContent        = `üéØ ${chance}`;
    justificationEl.textContent = `üß† ${justification}`;
    suggestionEl.textContent    = `üìà ${suggestion}`;
  } catch (err) {
    chanceEl.textContent        = "‚ùå Prediction failed.";
    justificationEl.textContent = err.message;
    suggestionEl.textContent    = "";
  }
}
</script>

      <script>
  async function drawDemographics() {
    const resp = await fetch(
      "https://umbrixia-ai-github-io.onrender.com/api/demographic-trends"
    );
    if (!resp.ok) return console.error("Demo trends failed");

    const data = await resp.json();
    // data format: { labels: [...], values: [...] }
    new Chart(document.getElementById("demographicChart"), {
      type: "bar",
      data: {
        labels: data.labels,
        datasets: [{
          label: "Acceptance Rate (%)",
          data: data.values,
          backgroundColor: "#4caf50"
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, max: 100 }
        }
      }
    });
  }

  // Run on page load once logged in
  firebase.auth().onAuthStateChanged(user => {
    if (user) drawDemographics();
  });
</script>


 </body>
 </html>
